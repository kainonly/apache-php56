---
title: 易用的 Angular 辅助层框架(v1)
toc: true
---

[![npm (tag)](https://img.shields.io/npm/v/ngx-bit/v6-lts.svg?style=flat-square)](https://ngx-bit.kainonly.com/v/1)
[![Downloads](https://img.shields.io/npm/dm/ngx-bit.svg?style=flat-square)](https://www.npmjs.com/package/ngx-bit)
[![npm](https://img.shields.io/npm/dt/ngx-bit.svg?style=flat-square)](https://www.npmjs.com/package/ngx-bit)
[![TypeScript](https://img.shields.io/badge/%3C%2F%3E-TypeScript-blue.svg?style=flat-square)](https://www.typescriptlang.org/)
[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg?style=flat-square)](https://raw.githubusercontent.com/kainonly/ngx-bit.js/master/LICENSE)

请确认 `@angular/cli` 版本是否在 `v6-lts`, 如果不是请先移除原 `@angular/cli`, 再使用 `npm install @angular/cli@v6-lts -g` 安装

```shell
ng version
#      _                      _                 ____ _     ___
#     / \   _ __   __ _ _   _| | __ _ _ __     / ___| |   |_ _|
#    / △ \ | '_ \ / _` | | | | |/ _` | '__|   | |   | |    | |
#   / ___ \| | | | (_| | |_| | | (_| | |      | |___| |___ | |
#  /_/   \_\_| |_|\__, |\__,_|_|\__,_|_|       \____|_____|___|
#                 |___/
#
#
# Angular CLI: 6.2.7
# Node: 10.15.0
# OS: win32 x64
# Angular: 6.1.6
# ... animations, common, compiler, compiler-cli, core, forms
# ... http, language-service, platform-browser
# ... platform-browser-dynamic, router
#
# Package                            Version
# ------------------------------------------------------------
# @angular-devkit/architect          0.8.7
# @angular-devkit/build-angular      0.8.7
# @angular-devkit/build-ng-packagr   0.8.7
# @angular-devkit/build-optimizer    0.8.7
# @angular-devkit/build-webpack      0.8.7
# @angular-devkit/core               0.8.7
# @angular-devkit/schematics         0.8.7
# @angular/cdk                       6.4.7
# @angular/cli                       6.2.7
# @angular/pwa                       0.8.9
# @ngtools/json-schema               1.1.0
# @ngtools/webpack                   6.2.7
# @schematics/angular                0.8.7
# @schematics/update                 0.8.7
# ng-packagr                         4.4.0
# rxjs                               6.3.3
# typescript                         2.9.2
# webpack                            4.16.4

# Create Angular Project
ng new anyone
```

ng-zorro-antd 是 Ant Design 的 Angular 实现, 这里也是基于 ng-zorro-antd 进行辅助扩展, 对应 angular v6 版本需要安装 `ng-zorro-antd@1.8.x`

```shell
ng add ng-zorro-antd@1.8.x
```

ngx-bit 的部分功能依赖于 `@ngx-pwa/local-storage@v6` `sweetalert2`

```shell
npm install ngx-bit@v6-lts @ngx-pwa/local-storage@v6 sweetalert2@7 --save
```

> 也可以加入 Service Work 服务提高使用体验

```shell
ng add @angular/pwa@v6-lts
```

修改 `src/environments/environment.ts`, 生产环境则修改 `environment.prod.ts`

```typescript
export const environment = {
  production: false,
  bit: {
    origin: "https://api.develop.com",
    namespace: "/api",
    static: "https://cdn.develop.com/",
    uploads: "api/main/uploads",
    page_limit: 20,
    with_credentials: true,
    http_customize: true,
    i18n: ["zh_cn", "en_us"],
    i18n_switch: [
      {
        i18n: "zh_cn",
        name: {
          zh_cn: "中文",
          en_us: "Chinese",
        },
      },
      {
        i18n: "en_us",
        name: {
          zh_cn: "英文",
          en_us: "English",
        },
      },
    ],
  },
};
```

修改 `src/app/app.module.ts`

```typescript
import { BrowserModule } from "@angular/platform-browser";
import { NgModule } from "@angular/core";
import { BrowserAnimationsModule } from "@angular/platform-browser/animations";
import { HttpClientModule } from "@angular/common/http";
import { registerLocaleData } from "@angular/common";
import { ServiceWorkerModule } from "@angular/service-worker";
import { environment } from "../environments/environment";
import zh from "@angular/common/locales/zh";

import { NgZorroAntdModule, NZ_I18N, zh_CN } from "ng-zorro-antd";
import {
  BitService,
  EventsService,
  HttpService,
  NgxBitModule,
  ConfigService,
} from "ngx-bit";

registerLocaleData(zh);

import { AppComponent } from "./app.component";

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    BrowserAnimationsModule,
    HttpClientModule,
    NgZorroAntdModule,
    NgxBitModule,
    ServiceWorkerModule.register("ngsw-worker.js", {
      enabled: environment.production,
    }),
  ],
  providers: [
    {
      provide: ConfigService,
      useValue: environment.bit,
    },
    BitService,
    EventsService,
    HttpService,
    { provide: NZ_I18N, useValue: zh_CN },
  ],
  bootstrap: [AppComponent],
})
export class AppModule {}
```

创建 `src/app/app.router.module.ts`

```typescript
import { NgModule } from "@angular/core";
import { Routes, RouterModule } from "@angular/router";
import { DashboardsComponent } from "./dashboards/dashboards.component";
import { AppExtModule } from "./app.ext.module";

const routes: Routes = [
  {
    path: "",
    component: DashboardsComponent,
    children: [
      {
        path: "",
        loadChildren: "./pages/welcome/welcome.module#WelcomeModule",
      },
      {
        path: "{empty}",
        loadChildren: "./pages/empty/empty.module#EmptyModule",
      },
      {
        path: "{profile}",
        loadChildren: "./pages/profile/profile.module#ProfileModule",
      },
      {
        path: "{router-index}",
        loadChildren:
          "./pages/router-index/router-index.module#RouterIndexModule",
      },
      {
        path: "{router-add}",
        loadChildren: "./pages/router-add/router-add.module#RouterAddModule",
      },
      {
        path: "{router-edit}/:id",
        loadChildren: "./pages/router-edit/router-edit.module#RouterEditModule",
      },
    ],
  },
];

@NgModule({
  imports: [AppExtModule, RouterModule.forChild(routes)],
  declarations: [DashboardsComponent],
})
export class AppRouterModule {}
```

再次修改 `src/app/app.module.ts`，将路由模块引入

```typescript
const routes: Routes = [
  {
    path: "",
    loadChildren: "./app.router.module#AppRouterModule",
    canActivate: [Auth],
  },
  { path: "login", loadChildren: "./login/login.module#LoginModule" },
];

@NgModule({
  imports: [RouterModule.forRoot(routes, { useHash: true })],
})
export class AppModule {}
```

创建 `src/app/app.language.ts`

```typescript
export default {
  main: ["测试", "Test"],
  dashboard: ["仪表盘", "Dashboard"],
  language: ["中文", "English"],
  center: ["个人中心", "Center"],
  profile: ["信息修改", "Profile"],
  exit: ["退出系统", "Exit"],
  add: ["新增", "Add"],
  success: ["执行成功", "Success"],
  failed: ["执行失败", "Failed"],
  back: ["返回", "Back"],
  submit: ["提交", "Submit"],
  reset: ["重置", "Reset"],
  cancel: ["取消", "Cancel"],
  status: ["状态", "Status"],
  edit: ["编辑", "Edit"],
  delete: ["删除", "Delete"],
  checks_delete: ["删除选中", "Delete Selected"],
  on: ["开启", "On"],
  off: ["冻结", "Off"],
  yes: ["是", "Yes"],
  no: ["否", "No"],
  validating: ["正在验证...", "Validating..."],
  action: ["操作", "Action"],
  card_action: ["请选择操作", "Please Select Action"],
  notice: ["通知", "Notification"],
  upload: ["上传", "Upload"],
  upload_success: ["上传成功", "Upload Success"],
  upload_error: ["上传失败", "Upload Failed"],
  update_success: ["更新成功", "Update Success"],
  update_error: ["更新失败", "Update Failed"],
  update_error_msg: [
    "当前网络繁忙请稍后再试",
    "The current network is busy please try again later",
  ],
  update_success_msg: [
    "已为您更新该数据状态",
    "Thought you update this data state",
  ],
  sort: ["排序", "Sort"],
  offline: ["下线", "Offline"],
  online: ["上线", "Online"],
  form: ["表单信息", "Form Infomation"],
  operate_info: ["操作提示", "Info"],
  operate_success: ["操作成功", "Success"],
  add_success: ["数据已新增成功", "Data has been added successfully"],
  add_failed: ["数据新增失败", "Data addition failed"],
  add_success_msg: ["您是否要继续新增?", "would you want to continue?"],
  edit_success: ["数据修改成功", "Data modification succeeded"],
  edit_failed: ["数据修改失败", "Data modification failed"],
  edit_success_msg: ["您是否要继续修改?", "would you want to continue?"],
  operate_back: ["返回列表", "back"],
  add_continue: ["继续新增", "continue"],
  edit_continue: ["继续修改", "continue"],
  operate_error: ["操作失败", "Failed"],
  operate_ok: ["好的", "ok"],
  operate_warning: ["操作警告", "Warn"],
  delete_warning: ["您确定要执行删除?", "You are sure to delete?"],
  delete_cancel: ["再想想", "Think Again"],
  delete_yes: ["确认删除", "Confirm Deletion"],
  delete_success: ["数据已被删除", "Data has been deleted"],
  delete_error: [
    "请求错误，数据删除失败",
    "Request error, data deletion failed",
  ],
  sort_yes: ["确认排序", "Submit Sort"],
  sort_cancel: ["取消排序", "Cancel Sort"],
  sort_success: ["数据排序成功", "Successful data sorting"],
  sort_error: ["请求错误，数据排序失败", "Request error, data sorting failed"],
  selected: ["选中", "Selected"],
  items: ["项目", "items"],
  no_result: ["当前列表无数据", "No data in current list"],
  status_success: ["状态已更新成功", "Status updated successfully"],
  status_error: [
    "请求错误，状态更新失败",
    "Request error, status update failed",
  ],
  logout: ["登出提示", "Logout Response"],
  logout_success: ["登出成功", "Logout Success"],
  timeout: ["超时登出", "Timeout"],
  timeout_warning: [
    "您的登录已超时，请重新登录",
    "Your login has timed out, please log in again",
  ],
  rbac_error: [
    "您没有权限或该权限已被关闭",
    "You don't have permission or the permission has been turned off",
  ],
};
```

修改 `src/app/app.component.ts`，并注册公共语言包

```typescript
import { Component, OnInit } from "@angular/core";
import { BitService } from "ngx-bit";
import packer from "./app.language";

@Component({
  selector: "app-root",
  template: "<router-outlet></router-outlet>",
})
export class AppComponent implements OnInit {
  constructor(private bit: BitService) {}

  ngOnInit() {
    this.bit.registerLocales(packer, true);
  }
}
```

- `src/app/api` 接口目录
- `src/app/dashboard` 仪表板组件
- `src/app/guard` 守护模型
- `src/app/login` 登录组件
- `src/app/pages` 页面组件
- `src/app/app.component.ts` 根组件
- `src/app/app.ext.module.ts` 子模块共用模块
- `src/app/app.language.ts` 共用语言包
- `src/app/app.module.ts` 应用模块
- `src/app/router.module.ts` 路由模块
- `src/app/update.service.ts` service work 服务

修改 `package.json` 的 `scripts`

```json
{
  "start": "ng serve --host 0.0.0.0 --disable-host-check",
  "build": "ng build --prod --buildOptimizer"
}
```

## 基础

### 配置服务

#### origin: string

RESTful Api 请求接口的域名

> 例如 `https://api.develop.com`

#### namespace: string

RESTful Api 地址命名空间

> 例如，`system`，如果没有请设置为 `''`

#### static: string

静态资源地址

> 可以是 `origin` 域名的相对路径，也可以是 cdn 域名，例如，`https://cdn.develop.com/`

#### uploads: string

上传地址

> 可以是 `origin` 域名的相对路径，也可以是分离式上传服务器的域名

#### with_credentials: boolean

同源策略

> 如请求需要携带 Cookie 设置为 `true`

#### http_customize: boolean

开启请求拦截自定义处理, 对 RBAC 返回失败的统一请求进行拦截并返回提示

```typescript
import { Component, OnInit } from "@angular/core";
import { BitService, HttpService } from "ngx-bit";
import packer from "./app.language";
import { Observable, of } from "rxjs";
import { NzMessageService } from "ng-zorro-antd";

@Component({
  selector: "app-root",
  template: "<router-outlet></router-outlet>",
})
export class AppComponent implements OnInit {
  constructor(
    private bit: BitService,
    private message: NzMessageService,
    private http: HttpService
  ) {}

  ngOnInit() {
    this.bit.registerLocales(packer, true);
    this.http.customize = (res: any): Observable<any> => {
      if (res.error && res.msg === "error:rbac") {
        this.message.error(this.bit.l["rbac_error"]);
      }
      return of(res);
    };
  }
}
```

#### i18n: any[]

多语言组件类型标识

> 例如：设置中文与英文，`['zh_cn', 'en_us']`

#### i18n_switch: any[]

多语言组件集合，`i18n` 需要于标识对应

```typescript
[
  {
    i18n: "zh_cn",
    name: {
      zh_cn: "中文",
      en_us: "Chinese",
    },
  },
  {
    i18n: "en_us",
    name: {
      zh_cn: "英文",
      en_us: "English",
    },
  },
];
```

#### page_limit: number

分页, 默认值 `20`

### 工具服务

#### static: string

静态资源地址

```html
<img [src]="bit.static+'any.jpg'" />
```

#### uploads: string

上传地址, 可以在 upload 组件上调用此属性：

```html
<nz-upload nzName="anyone" [nzAction]="bit.uploads"></nz-upload>
```

#### form: FormGroup

组件内 `FormGroup` 对象, 定义主表单：

```html
<form nz-form [formGroup]="bit.form"></form>
```

#### forms: any

组件内多种 `FormGroup` 对象的组合, 定义主表单：

```html
<form nz-form [formGroup]="bit.forms['add']"></form>
```

#### locale: string

语言包标识, 默认 `zh_cn`

```html
<p>{{name[bit.locale]}}</p>
<p></p>
```

#### l: any

语言包索引，默认 `{}`, 在完成定义语言包之后可直接使用 `l` 获取相关语言

```html
<p>{{bit.l['name']}}</p>
```

#### i18ns: any[]

多语言组件标识，默认 `[]`, 使用在表单组件多语言化输入切换

```typescript
// switch = i18ns
<nz-radio-group [(ngModel)]="i18n"
                (ngModelChange)="change.emit($event)"
                nzSize="small">
  <label *ngFor="let x of switch" nz-radio-button [nzValue]="x.i18n">
    <span><b>{{x.name[bit.locale]}}</b></span>
  </label>
</nz-radio-group>
```

#### lists_loading: boolean

列表正在加载状态, 使用在表格或列表组件中

```html
<nz-table #table [nzLoading]="bit.lists_loading" nzSize="middle"> </nz-table>
```

#### page_limit: number

分页，默认为配置服务 `page_limit` 的值, 使用在表格或列表组件中

```html
<nz-table #table [nzPageSize]="bit.page_limit" nzSize="middle"> </nz-table>
```

#### lists_totals: number

列表数据总数, `lists_totals` 是由分页列表请求对象自动获取：

```html
<nz-table #table [nzTotal]="bit.lists_totals" nzSize="middle"> </nz-table>
```

#### lists_page_index: number

分页索引页, `lists_page_index` 是个双向绑定属性，可以通过外部去更改分页索引：

```html
<nz-table #table [(nzPageIndex)]="bit.lists_page_index" nzSize="middle">
</nz-table>
```

#### lists_all_checked: boolean

列表选项框状态为全选, `lists_all_checked` 是一个双向绑定属性，当全选选择框被动触发改变时，通过它的 `modelChange` 将同步其他数据的选择框状态：

```html
<nz-table>
  <thead>
    <tr>
      <th nzShowCheckbox [(nzChecked)]="bit.lists_all_checked"></th>
    </tr>
  </thead>
</nz-table>
```

#### lists_indeterminate: boolean

列表选项框状态为不完整选择, `nzIndeterminate` 是不完整选择属性，当符合条件时，表头全选选择框将变为该状态：

```html
<nz-table>
  <thead>
    <tr>
      <th nzShowCheckbox [nzIndeterminate]="bit.lists_indeterminate"></th>
    </tr>
  </thead>
</nz-table>
```

#### lists_disabled_action: boolean

列表操作板显示状态, 可在需要的标签中使用，已被选中的总数为 `0` 时，`lists_disabled_action=true`

```html
<button nz-button [disabled]="bit.lists_disabled_action" nzType="primary">
  执行选中的
</button>
```

#### lists_checked_number: number

列表选项框选择数量, 显示已被选中的总数：

```html
<p>{{bit.lists_checked_number}}</p>
```

#### setLocale(locale : 'zh_cn' | 'en_us')

语言包标识设置

- **locale** 语言包标识

语言包切换为英文：

```typescript
this.bit.setLocale("en_us");
```

语言包切换监听：

```typescript
this.events.on("locale").subscribe((args) => {
  console.log(args);
  // zh_cn or en_us
});
```

#### registerLocales(packer: any, common = false)

注册语言包

- **packer** language 文件
- **common** 是否为公共语言包

```typescript
const packer = {
  name: ["名称", "名称"],
};

this.bit.registerLocales(packer);
```

#### setMenu(data: any): Observable< boolean >

设置菜单本地存储

- **data** 从菜单列表数据

将菜单数据存储在本地存储内, 优化侧边栏导航、面包屑：

```typescript
this.main
  .menu()
  .pipe(switchMap((data) => this.bit.setMenu(data)))
  .subscribe((status) => {
    console.log(status);
  });
```

#### getMenu(route: string): Observable< any >

用路由地址获取对应的菜单数据

- **route** 路由名称

获取路由地址为 `/{admin-index}` 的菜单数据

```typescript
this.bit.getMenu("admin-index").subscribe((data) => {
  console.log(data);
});
```

#### i18nControls(options?: I18nControlsOptions)

多语言组件数值初始化

- **options** 多语言组件参数
  - **value** 默认值
  - **validate** 同步验证器
  - **asyncValidate** 异步验证器

表单初始化时设置多语言组件：

```typescript
this.bit.form = this.fb.group({
  name: this.fb.group(
    this.bit.i18nControls({
      validate: {
        zh_cn: Validators.required,
        en_us: Validators.required,
      },
    })
  ),
});
```

#### i18nCommonValidator(group: string)

多语言组件通用验证

- **group** FormGroup 名称

#### i18nUpdateValidity(group: string, i18n: string)

多语言组件验证更新

- **group** FormGroup 名称
- **i18n** 需更新的多语言组件标识

#### formExplain(name: string, async = false, field?: string): ValidationErrors | boolean

表单验证提示判断

- **name** 表单控件标识
- **async** 是否为包含异步验证
- **field** 组合 FormGroup 名称
- **Return** `ValidationErrors | boolean`

```html
<nz-form-explain *ngIf="bit.formExplain('anyone',true)"></nz-form-explain>
<nz-form-explain *ngIf="bit.formExplain('anyone',true,'add')"></nz-form-explain>
```

#### explain(name: string, sign: string, field?: string): boolean

表单验证类型判断

- **name** 表单控件标识
- **sign** 判断类型
- **field** 组合 FormGroup 名称
- **Return** `boolean`

```html
<ng-container *ngIf="bit.explain('anyone','required')">
  {{bit.l['anyone_require']}}!
</ng-container>
<ng-container *ngIf="bit.explain('anyone','required','add')">
  {{bit.l['anyone_require']}}!
</ng-container>
```

#### submit(event, callback, field?: string)

表单提交阻止原生与检测

- **event** 表单 event 事件
- **callback** 回调事件
- **field** 组合 FormGroup 名称

```html
<form
  nz-form
  [formGroup]="bit.form"
  (submit)="bit.submit($event,submit)"
></form>
<form
  nz-form
  [formGroup]="bit.form"
  (submit)="bit.submit($event,submit,'add')"
></form>
```

#### back()

返回访问前一页

```typescript
constructor(public bit: BitService) {
    console.log(this.bit.back())
}
```

#### registerSearch(selector: string, ...search: any[]): Observable< any >

注册搜索字段

- **selector** 命名
- **search** `{field: string, value: any, op?: string }[]` 搜索参数
  - **field** 搜索字段名称
  - **value** 搜索值
  - **op** 判断类型, 不存在时为模糊搜索
- **Return** `Observable< any >` 搜索注册完成

#### listsRefreshStatus(lists: any[])

列表选择监听

- **lists** 数据源

在表格中的每个子选择框触发变化事件时，判断数据是否全选、不全选或完全不选择：

```html
<nz-table>
  <tbody>
    <tr *ngFor="let data of table.data">
      <td
        nzShowCheckbox
        [(nzChecked)]="data.checked"
        (nzCheckedChange)="bit.listsRefreshStatus(lists)"
      ></td>
    </tr>
  </tbody>
</nz-table>
```

#### listsCheckAll(event, lists: any[])

列表全选选择监听

- **event** 选择框状态改变触发事件
- **lists** 数据源

在表头命名层全选选择框选中后，同步每个数据的选择框状态

```html
<nz-table>
  <thead>
    <tr>
      <th
        nzShowCheckbox
        (nzCheckedChange)="bit.listsCheckAll($event,lists)"
      ></th>
    </tr>
  </thead>
</nz-table>
```

#### statusChange(service: Observable< any >, custom?: any)

状态更新

- **service** 状态切换请求
- **custom** 自定义处理错误提示

`main.status` 是一个状态切换请求对象，当监听到状态切换时，同步数据到服务器，对组件这样定义：

```html
<nz-switch
  [nzCheckedChildren]="bit.l['on']"
  [nzUnCheckedChildren]="bit.l['off']"
  [(ngModel)]="data.status"
  [nzControl]="true"
  (click)="bit.statusChange(anyService.status(data),statusCallback)"
>
</nz-switch>
```

自定义错误提示，statusCallback 函数

```typescript
statusCallback = (res: any) => {
  switch (res.msg) {
    case "error:self":
      this.notification.error(
        this.bit.l["operate_error"],
        this.bit.l["error_status_self"]
      );
      break;
    default:
      this.notification.error(
        this.bit.l["operate_error"],
        this.bit.l["status_error"]
      );
  }
};
```

### 请求服务

#### 创建请求对象

- req(url: string, body: any = {}, , method = 'post'): Observable< any >
- **url** 请求路由
- **body** 发送数据
- **method** 请求类型, 默认为 `post` 请求
- **Return** `Observable< any >`

> 在之前需要定义配置 `origin` `namespace`

例如：请求导航接口

```typescript
this.http.req("main/nav").subscribe((res) => {
  console.log(res);
});
```

#### 如何跨域携带 Cookie

在 `environment` 中启用

```typescript
export const environment = {
  bit: {
    with_credentials: true,
  },
};
```

#### 如何对请求做出拦截

在 `environment` 中启用

```typescript
export const environment = {
  bit: {
    http_customize: true,
  },
};
```

例如，对 RBAC 返回失败的统一请求进行拦截并返回提示

```typescript
import { Component, OnInit } from "@angular/core";
import { BitService, HttpService } from "ngx-bit";
import { Observable, of } from "rxjs";
import { NzMessageService } from "ng-zorro-antd";
import packer from "./app.language";

@Component({
  selector: "app-root",
  template: "<router-outlet></router-outlet>",
})
export class AppComponent implements OnInit {
  constructor(
    private bit: BitService,
    private message: NzMessageService,
    private http: HttpService
  ) {}

  ngOnInit() {
    this.bit.registerLocales(packer, true);
    this.http.customize = (res: any): Observable<any> => {
      if (res.error && res.msg === "error:rbac") {
        this.message.error(this.bit.l["rbac_error"]);
      }
      return of(res);
    };
  }
}
```

### 组件通讯服务

#### publish(topic: string, args?: any)

发布组件通讯事件

- **topic** 主题名称
- **args** 发送参数

```typescript
this.events.publish("any", {
  name: "kain",
});
```

#### on(topic: string): Observable< any >

订阅组件通讯事件

- **topic** 主题名称
- **Return** `Observable< any >`

```typescript
this.events.on("any").subscribe((args) => {
  console.log(args);
});
```

#### off(topic: string)

取消订阅的组件通讯事件

> 在每次路由组件 `OnDestory` 时，都需要将自定义事件取消订阅

- **topic** 主题名称

```typescript
this.events.off("any");
```

语言包切换事件

```typescript
this.events.on("locale").subscribe((args) => {
  console.log(args);
  // zh_cn or en_us
});
```

## CURD

### 新增数据请求

#### customAction(name: string)

设置自定义函数名

- **name** 函数名，请求地址默认为 `model+'/add'`，通过 `name` 修改 `'/add'`

#### factory(model: string, data: any)

生成新增请求

- **model** 模块名称
- **data** 发送数据
- **Return** `Observable< any >`

为管理员服务生成新增请求接口

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private addService: AddService) {}

  add(data: any) {
    return this.addService.factory(this.model, data);
  }
}
```

将管理员服务注入在应用模块下的供应商内

```typescript
@NgModule({
  providers: [AdminService],
})
export class AppModule {}
```

在组件中使用

```typescript
export class AdminAddComponent implements OnInit {
  constructor(private adminService: AdminService) {}

  submit = (data) => {
    this.adminService.add(data).subscribe((res) => {
      // res
    });
  };
}
```

### 删除数据请求

#### customAction(name: string)

设置自定义函数名

- **name** 函数名，请求地址默认为 `model+'/delete'`，通过 `name` 修改 `'/delete'`

#### factory(model: string, condition: any)

生成删除请求

- **model** 模块名称
- **condition** 删除条件
- **Return** `Observable< any >`

将管理员服务注入在应用模块下的供应商内

```typescript
@NgModule({
  providers: [AdminService],
})
export class AppModule {}
```

例如：如果 `id` 为条件，这里可以是 `单个id` 也可以是 `多个id构成的数组`

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private deleteService: DeleteService) {}

  delete(id: any): Observable<any> {
    return this.deleteService.factory(this.model, {
      id: id,
    });
  }
}
```

例如：如果不以 `id` 为条件，这里需要用条件数组来做参数

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private deleteService: DeleteService) {}

  deleteNoId(condition: any): Observable<any> {
    return this.deleteService.factory(this.model, condition);
  }
}
```

调用自定删除

```typescript
this.admin.deleteNoId([["name", "=", "one"]]);
```

### 编辑数据请求

#### customAction(name: string)

设置自定义函数名

- **name** 函数名，请求地址默认为 `model+'/edit'`，通过 `name` 修改 `'/edit'`

#### factory(model: string, data: any, condition: any = [])

生成新增请求

- **model** 模块名称
- **data** 发送数据
- **condition** 条件数组
- **Return** `Observable< any >`

将管理员服务注入在应用模块下的供应商内

```typescript
@NgModule({
  providers: [AdminService],
})
export class AppModule {}
```

例如：请求数据包含 id 无需使用条件数组

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private editService: EditService) {}

  edit(data: any): Observable<any> {
    return this.editService.factory(this.model, data);
  }
}
```

例如：请求数组需要其他条件时，需要定义条件数组

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private editService: EditService) {}

  editSpecial(data: any, condition: any): Observable<any> {
    return this.editService.factory(this.model, data, condition);
  }
}
```

调用编辑请求

```typescript
this.admin.editSpecial({ name: "two" }, [["uuid", "=", "xxx"]]);
```

### 获取单条数据请求

#### customAction(name: string)

设置自定义函数名

- **name** 函数名，请求地址默认为 `model+'/get'`，通过 `name` 修改 `'/get'`

#### factory(model: string, condition: any)

生成新增请求

- **model** 模块名称
- **condition** 条件数组
- **Return** `Observable< any >`

将管理员服务注入在应用模块下的供应商内

```typescript
@NgModule({
  providers: [AdminService],
})
export class AppModule {}
```

例如：如果 `id` 为条件，这里只能是 `单个id`

```typescript
@Injectable()
export class AdminService {
    private model = 'admin';

    constructor(private getService: GetService) {}

    get(id: any) {
        return this.getService.factory(this.model, {
            id: id
        });
    }
  }
}
```

例如：如果不以 `id` 为条件，这里需要用条件数组来做参数

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private getService: GetService) {}

  getNoId(condition: any): Observable<any> {
    return this.getService.factory(this.model, condition);
  }
}
```

调用自定获取

```typescript
this.admin.getNoId([["name", "=", "one"]]);
```

### 获取分页数据请求

#### customAction(name: string)

设置自定义函数名

- **name** 函数名，请求地址默认为 `model+'/lists'`，通过 `name` 修改 `'/lists'`

#### factory(model: string, condition: any[] = [], like: any = [], refresh?: boolean)

生成新增请求

- **model** 模块名称
- **condition** 条件数组
- **like** 模糊搜索数组
- **refresh** 刷新参数，将分页、列表等初始化
- **Return** `Observable< any >`

将管理员服务注入在应用模块下的供应商内

```typescript
@NgModule({
  providers: [AdminService],
})
export class AppModule {}
```

为管理员 api 服务生成分页列表数据请求服务

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private listsService: ListsService) {}

  lists(search: any, refresh: boolean): Observable<any> {
    return this.listsService.factory(this.model, [], search, refresh);
  }
}
```

模糊搜索调用

```typescript
this.admin.lists([{ field: "username", value: "o" }], true);
```

### 获取列表数据请求

#### customAction(name: string)

设置自定义函数名

- **name** 函数名，请求地址默认为 `model+'/originLists'`，通过 `name` 修改 `'/originLists'`

#### factory(model: string, condition: any[] = [], like: any = [])

生成新增请求

- **model** 模块名称
- **condition** 条件数组
- **like** 模糊搜索数组
- **Return** `Observable< any >`

将管理员服务注入在应用模块下的供应商内

```typescript
@NgModule({
  providers: [AdminService],
})
export class AppModule {}
```

为管理员 api 服务生成分页列表数据请求服务

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private originListsService: OriginListsService) {}

  lists(search: any): Observable<any> {
    return this.originListsService.factory(this.model, [], search);
  }
}
```

模糊搜索调用

```typescript
this.admin.lists([{ field: "username", value: "o" }]);
```

### 状态变更请求

#### customAction(name: string)

设置自定义函数名

- **name** 函数名，请求地址默认为 `model+'/edit'`，通过 `name` 修改 `'/edit'`

#### factory(model: string, data: any, field = 'status')

生成状态切换请求

- **model** 模块名称
- **data** 状态修改数据引用，必须包含主键与状态字段
- **field** 状态字段名称
- **Return** `Observable< any >`

将管理员服务注入在应用模块下的供应商内

```typescript
@NgModule({
  providers: [AdminService],
})
export class AppModule {}
```

为管理员接口服务生成分页列表数据请求服务

```typescript
@Injectable()
export class AdminService {
  private model = "admin";

  constructor(private statusService: StatusService) {}

  status(data: any): Observable<any> {
    return this.statusService.factory(this.model, data);
  }
}
```

在模版中

```html
<nz-switch
  [nzCheckedChildren]="bit.l['on']"
  [nzUnCheckedChildren]="bit.l['off']"
  [(ngModel)]="data.status"
  [nzControl]="true"
  (click)="bit.statusChange(adminService.status(data),statusCallback)"
>
</nz-switch>
```

组件中

```typescript
export class AdminIndexComponent implements OnInit {
  constructor(
    public bit: BitService,
    public adminService: AdminService,
    private notification: NzNotificationService
  ) {}

  ngOnInit() {
    // customize
  }

  statusCallback = (res: any) => {
    switch (res.msg) {
      case "error:self":
        this.notification.error(
          this.bit.l["operate_error"],
          this.bit.l["error_status_self"]
        );
        break;
      default:
        this.notification.error(
          this.bit.l["operate_error"],
          this.bit.l["status_error"]
        );
    }
  };
}
```

## 指令

### 开始搜索

`[bit-search-start]`

- **searchSelector** 搜索命名
- **searchover** 开始搜索之后

注册搜索字段

```typescript
this.bit
  .registerSearch("test-index", {
    field: "name",
    value: "",
  })
  .subscribe(() => {
    // after
  });
```

开始搜索绑定在输入框 `enter` 事件

```html
<input
  *ngIf="bit.search[0]!==undefined"
  type="text"
  [(ngModel)]="bit.search[0].value"
  bit-search-start
  searchSelector="test-index"
  (searchover)="getLists(true)"
  nz-input
/>
```

开始搜索绑定在按钮 `click` 事件

```html
<button
  nz-button
  nzType="primary"
  nzSearch
  bit-search-start
  searchSelector="test-index"
  (searchover)="getLists(true)"
>
  <i nz-icon type="search"></i>
</button>
```

### 监听搜索

`[bit-search-change]`

- **searchSelector** 搜索命名
- **searchover** 搜索变动之后

监听搜索绑定在 `ngModelChange` 事件

```html
<nz-select
  [(ngModel)]="bit.search[0].value"
  bit-search-change
  searchSelector="test-index"
  (searchover)="getLists(true)"
>
  <nz-option [nzValue]="x.id" [nzLabel]="x.name"></nz-option>
</nz-select>
```

### 清空搜索

`[bit-search-clear]`

- **searchSelector** 搜索命名
- **searchclear** 清空搜索之后

清空搜索绑定在按钮 `click` 事件

```html
<button
  nz-button
  bit-search-clear
  searchSelector="test-index"
  (searchclear)="getLists(true)"
>
  清除搜索
</button>
```

## 管道

### 定义

- @Pipe({name: 'Defined'})
- **value** 数值
- **Return** `boolean`

例如，假设存在一个未定义属性

```typescript
export class AnyComponent {
  test;
}
```

在模版中判断使用

```html
<div *ngIf="test|Defined">
  <!-- here no display -->
</div>
```

### 未定义

- @Pipe({name: 'Undefined'})
- **value** 数值
- **Return** `boolean`

例如，假设存在一个未定义属性

```typescript
export class AnyComponent {
  test;
}
```

在模版中判断使用

```html
<div *ngIf="test|Undefined">
  <!-- here display -->
</div>
```

### 空数组

- @Pipe({name: 'EmptyArray'})
- **value** 数组
- **Return** `boolean`

例如，假设存在一个空数组属性

```typescript
export class AnyComponent {
  test = [];
}
```

在模版中判断使用

```html
<div *ngIf="!(test|EmptyArray)">
  <!-- here customize -->
</div>
```

### 空对象

- @Pipe({name: 'EmptyObject'})
- **value** 对象
- **Return** `boolean`

例如，假设存在一个空对象属性

```typescript
export class AnyComponent {
  test = {};
}
```

在模版中判断使用

```html
<div *ngIf="!(test|EmptyObject)">
  <!-- here customize -->
</div>
```

### 对象转数组

- @Pipe({name: 'ObjectToArray'})
- **value** 对象
- **Return** `any[]`

例如，假设一个对象

```typescript
export class AnyComponent {
  some = {
    car1: "blue",
    car2: "red",
  };
}
```

在模版中判断使用

```html
<div *ngFor="let x of some|ObjectToArray">
  <p>{{x.key}}</p>
  <p>{{x.rows}}</p>
</div>
```

### 对象转 Map 对象

- @Pipe({name: 'ObjectToMap'})
- **value** 对象
- **Return** `Map`

例如，假设一个对象

```typescript
export class AnyComponent {
  some = {
    car1: "blue",
    car2: "red",
  };
}
```

在模版中判断使用

```html
<ng-container *ngIf="some|ObjectToMap as x">
  <p>{{x.get('car1')}}</p>
</ng-container>
```

### 多语言填补显示

- @Pipe({name: 'JSONChose'})
- **value** 多语言类型的 JSON 字符串
- **locale** 语言包标识

例如，在接口直接返回多语言类型的 JSON 字符串

```typescript
const data = `{"zh_cn":"我","en_us":"me"}`;
```

如果指定某个语言为默认的显示

```html
<p>{{data|JSONChose:'en_us'}}</p>
<!-- display me -->
```

当然如果多语言类型的 JSON 字符串有缺失的语言存在

```typescript
const data = `{"zh_cn":"","en_us":"","ru-ru":"Я"}`;
```

这种情况则显示可以填补的语言

```html
<p>{{data|JSONChose}}</p>
<!-- display Я -->
```

### JSON 字符串转数组

- @Pipe({name: 'JSONParse'})
- **value** JSON 字符串
- **chkey** 子键

例如，在接口直接返回 JSON 字符串数组

```typescript
const data = `{"name":"bit","version":1}`;
```

在这种情况下直接使用管道可以减少遍历处理

```html
<p>{{data|JSONParse:name}}</p>
<!-- display bit -->
```

### 字符串分割为数组

- @Pipe({name: 'Split'})
- **text** 字符串
- **symbol** 分割符号
- **Return** `string`

例如，在一些场景下存在字符串

```typescript
const str = "a1|b2|c3";
```

那么可以通过该管道进行字符串分割

```html
<p>{{(str|Split:'|')[0]}}</p>
<!-- display a1 -->
```

### 数组拼接为字符串

- @Pipe({name: 'Join'})
- **origin** 字符串数组
- **symbol** 拼接符号
- **Return** `string`

例如，在一些场景下存在字符串数组

```typescript
const data = ["a1", "b2", "c3"];
```

那么可以通过该管道进行字符串拼接

```html
<p>{{data|Join:','}}</p>
<!-- display a1,b2,c3 -->
```

## 操作

### 判断空数组

- emptyArray(array: any[])
- **array** 数组
- **Return** `boolean`

判断一个数组是否为空

```typescript
const test = [];

emptyArray(test);
// true
```

### 判断空对象

- emptyObject(object: any)
- **object** 对象
- **Return** `boolean`

判断一个对象是否为空

```typescript
const test = {};

emptyObject(test);
// true
```

### 对象转数组

- objectToArray(object: any)
- **object** 对象
- **Return** `any[]`
  - **key** 原主键
  - **rows** 原键值

将一个对象转为数组

```typescript
const some = {
  car1: "blue",
  car2: "red",
};
objectToArray(some);
// [
//    {key: 'car1', rows: 'blue'},
//    {key: 'car2', rows: 'red'}
// ]
```

### 对象转 Map 对象

- objectToMap(object: any)
- **object** 对象
- **Return** `Map<any,any>|false`

将一个对象转为 Map 对象

```typescript
const some = {
  car1: "blue",
  car2: "red",
};
const t = objectToMap(some);
if (t) {
  console.log(t.get("car1"));
  // blue
}
```

### 搜索条件筛选

- whereAndLike(search: any)

注册的搜索条件中存在多种方式，则使用该函数在请求服务内进行筛选

```typescript
// search = this.bit.search
lists(search: any, refresh: boolean): Observable<any> {
    const {where, like} = whereAndLike(search);
    return this.listsService.factory(this.model, where, like, refresh).pipe(map(res => {
        if (!res.error) {
            return res.data.lists;
        } else {
            return [];
        }
    }));
}
```

### 语言包生产

- factoryLocales(packer: any)
- **packer** 语言包文件

定义一个语言包数据，索引顺序按照 `['zh_cn','en_us']`

```typescript
export default {
  username: ["用户名称", "Username"],
  username_placeholder: ["请输入用户名称", "Please Enter Username"],
  username_require: [
    "当前用户名称不能为空",
    "Current user name cannot be empty",
  ],
  username_correctly: [
    "请输入正确的用户名称",
    "Please enter the correct username",
  ],
  username_duplicated: [
    "当前用户名称已存在",
    "Current user name already exists",
  ],
  role: ["权限组", "Role Group"],
  role_placeholder: ["请选择权限组", "Please Enter Role Group"],
  password: ["用户密码", "Password"],
  password_placeholder: ["请输入用户密码", "Please Enter Password"],
  password_require: ["请输入用户密码", "Please Enter Password!"],
  password_correctly: [
    "请输入正确的用户密码",
    "Please enter the correct user password",
  ],
  call: ["称呼", "Call Name"],
  call_placeholder: ["请输入称呼", "Please Enter Call Name"],
  email: ["电子邮件", "Email"],
  email_placeholder: ["请输入电子邮件", "Please Enter Email"],
  email_correctly: ["请输入正确的电子邮件", "Please enter the correct email"],
  phone: ["联系电话", "Phone"],
  phone_placeholder: ["请输入手机号码", "Please Enter Phone"],
  avatar: ["头像", "Avatar"],
};
```

语言包生产

```typescript
import packer from "./language";

const language = factoryLocales(packer);

console.log(language.zh_cn.username); // 用户名称
console.log(language.en_us.username); // Username
```

### 获取路由名称

- getRouteName(url: string, start = '%7B', end = '%7D'): string
- **url** 完整路由地址
- **start** 起始符
- **end** 结束符
- **Return** 路由名称

可以在路由事件监听中使用

```typescript
export class DashboardsComponent implements OnInit {
  constructor(private router: Router) {}

  ngOnInit() {
    this.router.events.subscribe((event) => {
      // current url /{admin-edit}/1
      if (event instanceof NavigationEnd) {
        getRouteName(event.url);
        // admin-edit
      }
    });
  }
}
```

### 组件异步验证器

- asyncValidator(req: Observable<any>, field = 'duplicated')
- **req** 请求对象
- **field** 自定义返回

在组件内定义异步验证器

```typescript
export class AdminAddComponent implements OnInit {
  constructor(
    private swal: SwalService,
    private fb: FormBuilder,
    public bit: BitService,
    private notification: NzNotificationService,
    private adminService: AdminService
  ) {}

  ngOnInit() {
    this.bit.form = this.fb.group({
      username: [
        null,
        [
          Validators.required,
          Validators.minLength(4),
          Validators.maxLength(20),
        ],
        [this.validedUsername],
      ],
    });
  }

  validedUsername = (control: AbstractControl) =>
    asyncValidator(this.adminService.validedUsername(control.value));
}
```

### 多语言组件初始值

- i18nControlsValue(i18n: string, value?: any)
- **i18n** 多语言组件标识
- **value** 多语言组件数值

### 多语言组件同步验证

- i18nControlsValidate(i18n: string, validate?: any)
- **i18n** 多语言标识
- **validate** 响应式同步验证数组

### 多语言组件异步验证

- i18nControlsAsyncValidate(i18n: string, asyncValidate?: any)
- **i18n** 多语言标识
- **asyncValidate** 响应式异步验证数组

## 公共服务

### 提交反馈栏

#### - addAlert(res: any, reset?: any, customize?: AlertCustomize)

新增返回反馈栏

- **res** 请求响应结果
- **reset** FormGroup 重置值
- **customize** 自定义文本
  - **text** 提示文本
  - **error_text** 返回错误提示文本
  - **confirmButtonText** 确认按钮文本
  - **cancelButtonText** 取消按钮文本
- **Return** `Observable<any>`

例如, 在新增操作下组件表单提交中使用, `status` 为 `true` 表示确认提示框

```typescript

export class AdminAddComponent implements OnInit {

    ...

    submit = (data) => {
        this.adminService.add(data).pipe(
            switchMap(res => this.swal.addAlert(res, {
                status: true
            }))
        ).subscribe((status) => {
            // status => true or false
        });
    };
}
```

#### - editAlert(res: any, customize?: AlertCustomize)

修改返回反馈栏

- **res** 请求响应结果
- **customize** 自定义文本
  - **text** 提示文本
  - **error_text** 返回错误提示文本
  - **confirmButtonText** 确认按钮文本
  - **cancelButtonText** 取消按钮文本
- **Return** `Observable<any>`

例如, 在修改操作下组件表单提交中使用, `status` 为 `true` 表示确认提示框

```typescript
export class AdminEditComponent implements OnInit {
    private id: any;

    ...

    submit = (data) => {
        data.id = this.id;
        this.adminService.edit(data).pipe(
            switchMap(res => this.swal.editAlert(res))
        ).subscribe((status) => {
            // status => true or false
        });
    };
}
```

#### deleteAlert(service: Observable< any >, customize?: AlertCustomize)

删除返回反馈栏

- **service** 删除请求对象
- **customize** 自定义文本
  - **text** 提示文本
  - **confirmButtonText** 确认按钮文本
  - **cancelButtonText** 取消按钮文本
- **Return** `Observable<any>`

例如, 在删除操作下使用, 订阅返回删除请求对象的响应值

```typescript
export class AdminIndexComponent implements OnInit {
    ...

  deleteData(id: any) {
    this.swal.deleteAlert(this.adminService.delete(id)).subscribe(res => {
      if (!res.error) {
        this.notification.success(this.bit.l['operate_success'], this.bit.l['delete_success']);
        this.getLists(true);
      } else {
        switch (res.msg) {
          case 'error:self':
            this.notification.error(this.bit.l['operate_error'], this.bit.l['error_delete_self']);
            break;
          default:
            this.notification.error(this.bit.l['operate_error'], this.bit.l['delete_error']);
        }
      }
    });
  }
}
```

#### SwalService.native(title: string, message?: string, type?: SweetAlertType)

自定义反馈栏

- **title** 标题
- **message** 主体信息
- **type** `SweetAlertType` 定义参数
- **Return** `Promise<SweetAlertResult>`

#### SwalService.native(settings: SweetAlertOptions & { useRejections?: false })

自定义反馈栏

- **settings** `SweetAlertOptions` 对象定义反馈栏
- **Return** `Promise<SweetAlertResult>`

## 组件

### 表单实例

定义组件：需要注入 `BitService`、`FormBuilder`, 需要在 `ngOnInit` 周期下定义好 `FormGroup` 对象的 `this.bit.form`

```typescript
export class AdminAddComponent implements OnInit {
  // 注入相关依赖
  constructor(
    private swal: SwalService,
    private fb: FormBuilder,
    public bit: BitService,
    private notification: NzNotificationService,
    private adminService: AdminService
  ) {}

  ngOnInit() {
    // 这里定义好 this.bit.form
    this.bit.form = this.fb.group({
      username: [
        null,
        [
          Validators.required,
          Validators.minLength(4),
          Validators.maxLength(20),
        ],
        [this.validedUsername],
      ],
    });
  }

  validedUsername = (control: AbstractControl) =>
    asyncValidator(this.adminService.validedUsername(control.value));

  submit = (data) => {
    // 这里定义提交，data是表单提交的结果
  };
}
```

在模版中使用通用处理属性, `bit.submit(event, callback)` 中 `$event` 一定要赋值，这样是为了防止默认表单提交与前端验证处理, `callback` 则是在组件中的 `submit` 函数

```html
<form nz-form [formGroup]="bit.form" (submit)="bit.submit($event,submit)">
  <!-- 这里是写表单内组件 -->
  <nz-form-item>
    <nz-form-label [nzSpan]="7" nzRequired>
      {{bit.l['username']}}
    </nz-form-label>
    <nz-form-control [nzSpan]="12" nzHasFeedback>
      <input
        nz-input
        formControlName="username"
        [placeholder]="bit.l['username_placeholder']"
      />
      <nz-form-explain *ngIf="bit.formExplain('username',true)">
        <ng-container *ngIf="bit.explain('username','required')">
          {{bit.l['username_require']}}
        </ng-container>
        <ng-container
          *ngIf="bit.explain('username','minlength')||bit.explain('username','maxlength')"
        >
          {{bit.l['username_correctly']}}
        </ng-container>
        <ng-container *ngIf="bit.explain('username','duplicated')">
          {{bit.l['username_duplicated']}}
        </ng-container>
        <ng-container *ngIf="bit.explain('username','pending')">
          {{bit.l['validating']}}
        </ng-container>
      </nz-form-explain>
    </nz-form-control>
  </nz-form-item>
</form>
```

#### formControlName="username"

对应组件中 `this.form.get('username')` 对象，如获取这个 `FormContol` 的数值，需要 `this.form.get('username').value`

#### bit.formExplain('username',true)

其中 `true` 代表对这个 `FormContol` 是包含异步验证的，如果仅有同步验证可以写成 `bit.formExplain('username')`。如果包含异步验证条件设为同步，这里将会不能正常工作

#### bit.explain('username','required')

代表这个 `FormContol` 有 `required` 错误

### 表格实例

```html
<nz-table
  #table
  [nzData]="lists"
  [nzLoading]="bit.lists_loading"
  [nzNoResult]="bit.l['no_result']"
  [nzTotal]="bit.lists_totals"
  [nzPageSize]="bit.page_limit"
  [nzFrontPagination]="false"
  [(nzPageIndex)]="bit.lists_page_index"
  (nzPageIndexChange)="getLists()"
  nzSize="middle"
>
  <thead>
    <tr>
      <th
        nzShowCheckbox
        [(nzChecked)]="bit.lists_all_checked"
        [nzIndeterminate]="bit.lists_indeterminate"
        (nzCheckedChange)="bit.listsCheckAll($event,lists)"
      ></th>
      <th>{{bit.l['username']}}</th>
      <th>{{bit.l['role']}}</th>
      <th>{{bit.l['email']}}</th>
      <th>{{bit.l['phone']}}</th>
      <th>{{bit.l['call']}}</th>
      <th>{{bit.l['status']}}</th>
      <th>{{bit.l['action']}}</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of table.data">
      <td
        nzShowCheckbox
        [(nzChecked)]="data.checked"
        (nzCheckedChange)="bit.listsRefreshStatus(lists)"
      ></td>
      <td>{{data.username}}</td>
      <td>{{role_lists[data.role]|JSONParse:bit.locale}}</td>
      <td>{{data.email}}</td>
      <td>{{data.phone}}</td>
      <td>{{data.call}}</td>
      <td>
        <nz-switch
          [nzCheckedChildren]="bit.l['on']"
          [nzUnCheckedChildren]="bit.l['off']"
          [(ngModel)]="data.status"
          [nzControl]="true"
          (click)="bit.statusChange(adminService.status(data),statusCallback)"
        >
        </nz-switch>
      </td>
      <td>
        <a routerLink="/{admin-edit}/{{data.id}}">
          <i nz-icon type="edit"></i> {{bit.l['edit']}}
        </a>
        <nz-divider nzType="vertical"></nz-divider>
        <a (click)="deleteData(data.id)">
          <i nz-icon type="delete"></i> {{bit.l['delete']}}
        </a>
      </td>
    </tr>
  </tbody>
</nz-table>
```

### 上传方式

在组件中定义上传相关函数与属性，因为使用 FormGroup 会缺乏一些灵活性，所以可以直接将上传属性定义在组件中，最后提交前再去整合提交数据

```typescript
export class AdminAddComponent implements OnInit {
  avatar = "";

  constructor(
    private swal: SwalService,
    private fb: FormBuilder,
    public bit: BitService,
    private notification: NzNotificationService,
    private adminService: AdminService,
    private roleService: RoleService
  ) {}

  upload(info) {
    if (info.type === "success") {
      this.avatar = info.file.response.data.save_name;
      this.notification.success(
        this.bit.l["success"],
        this.bit.l["upload_success"]
      );
    }
    if (info.type === "error") {
      this.notification.error(this.bit.l["notice"], this.bit.l["upload_error"]);
    }
  }

  submit = (data) => {
    if (this.avatar) {
      data.avatar = this.avatar;
    }
  };
}
```

在模版中使用

```html
<nz-form-item>
  <nz-form-label [nzSpan]="7" nzRequired> {{bit.l['avatar']}} </nz-form-label>
  <nz-form-control [nzSpan]="12">
    <p>{{bit.l['avatar_tips']}}</p>
    <nz-upload
      nzName="image"
      [nzWithCredentials]="true"
      [nzAction]="bit.uploads"
      [nzSize]="5120"
      nzListType="picture-card"
      [nzShowUploadList]="false"
      (nzChange)="upload($event)"
    >
      <ng-container *ngIf="!avatar">
        <i nz-icon type="plus"></i>
        <div class="ant-upload-text">{{bit.l['upload']}}</div>
      </ng-container>
      <img
        width="120"
        *ngIf="avatar"
        [src]="bit.static+avatar"
        class="avatar"
      />
    </nz-upload>
  </nz-form-control>
</nz-form-item>
```

#### nzWithCredentials

如果存在携带 `Cookie` 必须将其设为 `true`，通常前后端分离会将 `Token` 存在服务端的 `Cookie` 中

#### nzAction

则是上传请求地址，可以直接调用 `bit.uploads`

#### nzChange

中函数就是组件中的上传

### 语言包定义

每个模块下语言包会以公用 + 独自的形式存在，定义语言包 `language.ts`

```typescript
export default {
  username: ["用户名称", "Username"],
  username_placeholder: ["请输入用户名称", "Please Enter Username"],
  username_require: [
    "当前用户名称不能为空",
    "Current user name cannot be empty",
  ],
  username_correctly: [
    "请输入正确的用户名称",
    "Please enter the correct username",
  ],
  username_duplicated: [
    "当前用户名称已存在",
    "Current user name already exists",
  ],
  role: ["权限组", "Role Group"],
  role_placeholder: ["请选择权限组", "Please Enter Role Group"],
  password: ["用户密码", "Password"],
  password_placeholder: ["请输入用户密码", "Please Enter Password"],
  password_require: ["请输入用户密码", "Please Enter Password!"],
  password_correctly: [
    "请输入正确的用户密码",
    "Please enter the correct user password",
  ],
  call: ["称呼", "Call Name"],
  call_placeholder: ["请输入称呼", "Please Enter Call Name"],
  email: ["电子邮件", "Email"],
  email_placeholder: ["请输入电子邮件", "Please Enter Email"],
  email_correctly: ["请输入正确的电子邮件", "Please enter the correct email"],
  phone: ["联系电话", "Phone"],
  phone_placeholder: ["请输入手机号码", "Please Enter Phone"],
  avatar: ["头像", "Avatar"],
};
```

在组件内引入语言包，并注册到 `bit.l` 属性中

```typescript
// 移入语言包
import packer from "./language";

export class AdminAddComponent implements OnInit {
  constructor(public bit: BitService, private adminService: AdminService) {}

  ngOnInit() {
    // 注册语言包
    this.bit.registerLocales(packer);
  }
}
```

#### this.bit.registerLocales(packer)

将语言包注册至 `bit.l`，这样模版下就能直接使用 `bit.l['any']`

### 多语言设置

组件均可以使用 Ng-Zorro，设定多语言输入模式需要设定一个统一切换按钮, 在 `card` 的头部加入 `<i18n-switch></i18n-switch>`

```html
<ng-template #tools>
  <i18n-switch [(i18n)]="i18n"></i18n-switch>
</ng-template>
<nz-card [nzExtra]="tools"> </nz-card>
```

- `i18n` 是双向绑定属性，在对应的组件内设定

在表单中通过判断去切换多语言输入

```html
<nz-form-item formGroupName="name">
  <nz-form-label [nzSpan]="7" nzRequired> {{bit.l['name']}} </nz-form-label>
  <ng-template ngFor let-x [ngForOf]="bit.i18ns">
    <nz-form-control [nzSpan]="12" nzHasFeedback *ngIf="i18n===x">
      <input
        nz-input
        [formControlName]="x"
        [placeholder]="bit.l['name_placeholder']"
      />
      <nz-form-explain *ngIf="bit.formExplain('name.'+x)">
        {{bit.l['name_require']}}
      </nz-form-explain>
    </nz-form-control>
  </ng-template>
</nz-form-item>
```
