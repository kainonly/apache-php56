---
title: 易用的 Angular 辅助层框架(v7)
toc: true
---

[![npm (tag)](https://img.shields.io/npm/v/ngx-bit/v7-lts.svg?style=flat-square)](https://ngx-bit.kainonly.com/v/7)
[![Downloads](https://img.shields.io/npm/dm/ngx-bit.svg?style=flat-square)](https://www.npmjs.com/package/ngx-bit)
[![npm](https://img.shields.io/npm/dt/ngx-bit.svg?style=flat-square)](https://www.npmjs.com/package/ngx-bit)
[![TypeScript](https://img.shields.io/badge/%3C%2F%3E-TypeScript-blue.svg?style=flat-square)](https://www.typescriptlang.org/)
[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg?style=flat-square)](https://raw.githubusercontent.com/kainonly/ngx-bit.js/master/LICENSE)

初始化项目

```shell
ng new exercise
```

ng-zorro-antd 是 Ant Design 的 Angular 实现, 这里也是基于 ng-zorro-antd 进行辅助扩展

```shell
ng add ng-zorro-antd@7
```

ngx-bit 的部分功能依赖于 `@ngx-pwa/local-storage` `sweetalert2`

```shell
npm install ngx-bit@v7-lts @ngx-pwa/local-storage@v7 sweetalert2@8 --save
```

- @ngx-pwa/local-storage version >= 7.x
- sweetalert2 version >= 8.x

修改 `src/environments/environment.ts`

```typescript
export const environment = {
  production: false,
  bit: {
    originUrl: "https://api.developer.com",
    staticUrl: "https://cdn.developer.com/",
    iconUrl: "https://cdn.developer/icons/",
    namespace: "/sys",
    uploadsUrl: false,
    uploadsPath: "sys/main/uploads",
    withCredentials: true,
    httpInterceptor: true,
    pageLimit: 10,
    breadcrumbTop: 0,
    formControlCol: {
      common: {
        nzMd: 10,
        nzSm: 12,
        nzXs: 24,
      },
      submit: {
        nzMd: { span: 10, offset: 7 },
        nzSm: { span: 12, offset: 7 },
        nzXs: { span: 24, offset: 0 },
      },
    },
    formLabelCol: {
      common: {
        nzSm: 7,
        nzXs: 24,
      },
    },
    i18nDefault: "zh_cn",
    i18nContain: ["zh_cn", "en_us"],
    i18nSwitch: [
      {
        i18n: "zh_cn",
        name: {
          zh_cn: "中文",
          en_us: "Chinese",
        },
      },
      {
        i18n: "en_us",
        name: {
          zh_cn: "英文",
          en_us: "English",
        },
      },
    ],
  },
};
```

修改 `src/app/app.module.ts`，引入 `NgxBitModule`

```typescript
import { NgModule } from "@angular/core";
import { BrowserModule } from "@angular/platform-browser";
import { BrowserAnimationsModule } from "@angular/platform-browser/animations";
import { RouterModule, Routes } from "@angular/router";
import { HttpClientModule, HttpClientXsrfModule } from "@angular/common/http";
import { registerLocaleData } from "@angular/common";
import { NgZorroAntdModule, NZ_I18N, zh_CN } from "ng-zorro-antd";
import { NgxBitModule } from "ngx-bit";
import zh from "@angular/common/locales/zh";
import { environment } from "../environments/environment";

registerLocaleData(zh);

import { AppComponent } from "./app.component";

const routes: Routes = [
  {
    path: "",
    loadChildren: "./app.router.module#AppRouterModule",
    canActivate: [Auth],
  },
  { path: "login", loadChildren: "./login/login.module#LoginModule" },
];

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    BrowserAnimationsModule,
    HttpClientModule,
    HttpClientXsrfModule.withOptions({
      cookieName: "xsrf_token",
      headerName: "X-XSRF-TOKEN",
    }),
    NgZorroAntdModule,
    PerfectScrollbarModule,
    NgxBitModule.forRoot(environment.bit),
    RouterModule.forRoot(routes, { useHash: true }),
  ],
  providers: [{ provide: NZ_I18N, useValue: zh_CN }],
  bootstrap: [AppComponent],
})
export class AppModule {}
```

创建 `src/app/app.router.module.ts`

```typescript
import { NgModule } from "@angular/core";
import { Routes, RouterModule } from "@angular/router";
import { DashboardsComponent } from "./dashboards/dashboards.component";
import { AppExtModule } from "./app.ext.module";

const routes: Routes = [
  {
    path: "",
    component: DashboardsComponent,
    children: [
      {
        path: "",
        loadChildren: "./pages/welcome/welcome.module#WelcomeModule",
      },
      {
        path: "{empty}",
        loadChildren: "./pages/empty/empty.module#EmptyModule",
      },
      {
        path: "{profile}",
        loadChildren: "./pages/profile/profile.module#ProfileModule",
      },
      {
        path: "{router-index}",
        loadChildren:
          "./pages/router-index/router-index.module#RouterIndexModule",
      },
      {
        path: "{router-add}",
        loadChildren: "./pages/router-add/router-add.module#RouterAddModule",
      },
      {
        path: "{router-edit}/:id",
        loadChildren: "./pages/router-edit/router-edit.module#RouterEditModule",
      },
    ],
  },
];

@NgModule({
  imports: [AppExtModule, RouterModule.forChild(routes)],
  declarations: [DashboardsComponent],
})
export class AppRouterModule {}
```

创建 `src/app/app.language.ts`

```typescript
export default {
  main: ["NGX-BIT", "NGX-BIT"],
  dashboard: ["仪表盘", "Dashboard"],
  language: ["中文", "English"],
  center: ["个人中心", "Center"],
  profile: ["信息修改", "Profile"],
  exit: ["退出系统", "Exit"],
  add: ["新增", "Add"],
  success: ["执行成功", "Success"],
  failed: ["执行失败", "Failed"],
  back: ["返回", "Back"],
  submit: ["提交", "Submit"],
  reset: ["重置", "Reset"],
  cancel: ["取消", "Cancel"],
  status: ["状态", "Status"],
  edit: ["编辑", "Edit"],
  delete: ["删除", "Delete"],
  checksDelete: ["删除选中", "Delete Selected"],
  on: ["开启", "On"],
  off: ["冻结", "Off"],
  yes: ["是", "Yes"],
  no: ["否", "No"],
  validating: ["正在验证...", "Validating..."],
  action: ["操作", "Action"],
  notice: ["通知", "Notification"],
  upload: ["上传", "Upload"],
  uploadSuccess: ["上传成功", "Upload Success"],
  uploadError: ["上传失败", "Upload Failed"],
  updateSuccess: ["更新成功", "Update Success"],
  updateError: ["更新失败", "Update Failed"],
  updateErrorMsg: [
    "当前网络繁忙请稍后再试",
    "The current network is busy please try again later",
  ],
  updateSuccessMsg: [
    "已为您更新该数据状态",
    "Thought you update this data state",
  ],
  sort: ["排序", "Sort"],
  form: ["表单信息", "Form Infomation"],
  operateInfo: ["操作提示", "Info"],
  operateSuccess: ["操作成功", "Success"],
  addSuccess: ["数据已新增成功", "Data has been added successfully"],
  addFailed: ["数据新增失败", "Data addition failed"],
  addSuccessMsg: ["您是否要继续新增?", "would you want to continue?"],
  editSuccess: ["数据修改成功", "Data modification succeeded"],
  editFailed: ["数据修改失败", "Data modification failed"],
  editSuccessMsg: ["您是否要继续修改?", "would you want to continue?"],
  operateBack: ["返回列表", "back"],
  addContinue: ["继续新增", "continue"],
  editContinue: ["继续修改", "continue"],
  operateError: ["操作失败", "Failed"],
  operateOk: ["好的", "ok"],
  operateWarning: ["操作警告", "Warn"],
  deleteWarning: ["您确定要执行删除?", "You are sure to delete?"],
  deleteCancel: ["再想想", "Think Again"],
  deleteYes: ["确认删除", "Confirm Deletion"],
  deleteSuccess: ["数据已被删除", "Data has been deleted"],
  deleteError: [
    "请求错误，数据删除失败",
    "Request error, data deletion failed",
  ],
  sortYes: ["确认排序", "Submit Sort"],
  sortCancel: ["取消排序", "Cancel Sort"],
  sortSuccess: ["数据排序成功", "Successful data sorting"],
  sortError: ["请求错误，数据排序失败", "Request error, data sorting failed"],
  selected: ["选中", "Selected"],
  items: ["项目", "items"],
  clearSearch: ["清除搜索", "Clear Search"],
  noResult: ["当前列表无数据", "No data in current list"],
  noTips: ["无提示", "No prompt"],
  statusSuccess: ["状态已更新成功", "Status updated successfully"],
  statusError: [
    "请求错误，状态更新失败",
    "Request error, status update failed",
  ],
  logout: ["登出提示", "Logout Response"],
  logoutSuccess: ["登出成功", "Logout Success"],
  timeout: ["超时登出", "Timeout"],
  timeoutWarning: [
    "您的登录已超时，请重新登录",
    "Your login has timed out, please log in again",
  ],
  rbacError: [
    "您没有权限或该权限已被关闭",
    "You don't have permission or the permission has been turned off",
  ],
};
```

修改 `src/app/app.component.ts`，并注册公共语言包

```typescript
import { Component, OnInit } from "@angular/core";
import { BitService, ConfigService } from "ngx-bit";
import { Observable, of } from "rxjs";
import { NzMessageService } from "ng-zorro-antd";
import packer from "./app.language";

@Component({
  selector: "app-root",
  template: "<router-outlet></router-outlet>",
})
export class AppComponent implements OnInit {
  constructor(
    private bit: BitService,
    private message: NzMessageService,
    private config: ConfigService
  ) {}

  ngOnInit() {
    this.bit.registerLocales(packer, true);
    this.config.interceptor = (res: any): Observable<any> => {
      if (res.error && res.msg === "error:rbac") {
        this.message.error(this.bit.l.rbac_error);
      }
      return of(res);
    };
  }
}
```

修改 `package.json` 的 `scripts`

```json
{
  "start": "ng serve --port 4000",
  "serve:open": "ng serve --host 0.0.0.0 --port 4000 --disableHostCheck",
  "build": "ng build --prod --buildOptimizer",
  "server": "http-server -p 4000 -c-1 dist/exercise",
  "lint": "ng lint"
}
```

## 基础

### 配置

#### originUrl: string

RESTful Api 请求接口的域名，例如 `https://api.developer.com`

#### staticUrl: string

静态资源地址，可以是 `origin` 域名的相对路径，也可以是 cdn 域名，例如，`https://cdn.developer.com/`

#### iconUrl: string

放置在 CDN 上的 icons 路径，例如，`https://cdn.developer/icons/`

#### namespace: string

RESTful Api 地址命名空间，例如，`sys`，如果没有请设置为 `''`

#### uploadsUrl: boolean

是否为分布上传，`false` 为 `originUrl`+`/`+`uploadsPath`，`true` 时 `uploadsPath` 需填写完整上传地址

#### uploadsPath: string

上传地址

#### withCredentials: boolean

允许请求携带 Cookie，设置为 `true`

#### httpInterceptor: boolean

是否开启请求拦截

#### interceptor = (res) => of(res)

请求拦截自定义处理，例如对 RBAC 返回失败的统一请求进行拦截并返回提示

```typescript
import { Component, OnInit } from "@angular/core";
import { BitService, ConfigService } from "ngx-bit";
import { Observable, of } from "rxjs";
import { NzMessageService } from "ng-zorro-antd";
import packer from "./app.language";

@Component({
  selector: "app-root",
  template: "<router-outlet></router-outlet>",
})
export class AppComponent implements OnInit {
  constructor(
    private bit: BitService,
    private message: NzMessageService,
    private config: ConfigService
  ) {}

  ngOnInit() {
    this.bit.registerLocales(packer, true);
    this.config.interceptor = (res: any): Observable<any> => {
      if (res.error && res.msg === "error:rbac") {
        this.message.error(this.bit.l.rbac_error);
      }
      return of(res);
    };
  }
}
```

#### breadcrumbTop: any

面包屑默认最高级，默认 `0`

#### pageLimit: number

列表分页, 默认值 `20`

#### formControlCol: any

表单 `Control` 栅格统一设置

- common: any，表单公共栅格标识
- submit: any，表单提交栅格标识

```typescript
formControlCol: {
  common: {
    nzMd: 10,
    nzSm: 12,
    nzXs: 24
  },
  submit: {
    nzMd: {span: 10, offset: 7},
    nzSm: {span: 12, offset: 7},
    nzXs: {span: 24, offset: 0}
  }
}
```

#### formLabelCol: any

表单 `Label` 栅格统一设置

```typescript
formLabelCol: {
  common: {
    nzSm: 7,
    nzXs: 24
  },
}
```

#### i18nDefault: string

多语言输入组件默认标识，默认 `zh_cn`

#### i18nContain: any[]

多语言输入组件标识数组，例如：设置中文与英文，`['zh_cn', 'en_us']`

#### i18nSwitch: any[]

多语言组件集合，`i18n` 需要于标识对应

```typescript
[
  {
    i18n: "zh_cn",
    name: {
      zh_cn: "中文",
      en_us: "Chinese",
    },
  },
  {
    i18n: "en_us",
    name: {
      zh_cn: "英文",
      en_us: "English",
    },
  },
];
```

### 工具

#### static: string

静态资源地址，例如 `[src]="bit.static+'any.jpg'"`

#### uploads: string

上传地址, 可以在 upload 组件上调用 `[nzAction]="bit.uploads"`

#### locale: string

语言包标识, 默认 `zh_cn`，例如 `{{name[bit.locale]}}`

#### l: any

语言包索引，默认 `{}`, 在完成定义语言包之后可直接使用 `l` 获取相关语言，`{{bit.l['name']}}`

#### i18n: string

多语言输入组件当前标识

#### i18nTips: any

多语言输入组件验证提示

```html
<bit-i18n-tips #tips name="name"></bit-i18n-tips>
<input
  nz-input
  [placeholder]="bit.l['namePlaceholder']"
  [nz-tooltip]="tips.ref"
  bitI18nTipsStyle
  [formControlName]="x"
  (ngModelChange)="bit.i18nUpdateValueAndValidity(form,'name',x)"
/>
```

#### i18nContain: any[]

多语言输入组件标识数组

```html
<nz-form-item formGroupName="name">
  <nz-form-label bitFormLabelCol nzRequired> {{bit.l['name']}} </nz-form-label>
  <ng-container *ngFor="let x of bit.i18nContain">
    <nz-form-control *ngIf="bit.equalI18n(x)" bitFormControlCol nzHasFeedback>
      <bit-i18n-tips #tips name="name"></bit-i18n-tips>
      <input
        nz-input
        [placeholder]="bit.l['namePlaceholder']"
        [nz-tooltip]="tips.ref"
        bitI18nTipsStyle
        [formControlName]="x"
        (ngModelChange)="bit.i18nUpdateValueAndValidity(form,'name',x)"
      />
      <nz-form-explain
        *bitExplain="{
        form:form,
        name:'name.'+x,
        explain:{
            required:bit.l['nameRequire']
        }
        };let msg"
        >{{msg}}</nz-form-explain
      >
    </nz-form-control>
  </ng-container>
</nz-form-item>
```

#### title: string

当前路由名称，例如 `<nz-card [nzTitle]="bit.title"></nz-card>`

#### breadcrumb: any[]

面包屑数组

```html
<nz-breadcrumb [nzSeparator]="breadcrumbIcon">
  <ng-template #breadcrumbIcon>
    <i nz-icon type="right"></i>
  </ng-template>
  <nz-breadcrumb-item>
    <a routerLink="/">{{bit.l['dashboard']}}</a>
  </nz-breadcrumb-item>
  <nz-breadcrumb-item *ngFor="let x of bit.breadcrumb;last as islast">
    <ng-container *ngIf="islast;else notLast">{{x.name}}</ng-container>
    <ng-template #notLast>
      <a *ngIf="x.routerlink;else notRouterlink" [bitCrossLevel]="x.routerlink">
        {{x.name}}
      </a>
      <ng-template #notRouterlink>{{x.name}}</ng-template>
    </ng-template>
  </nz-breadcrumb-item>
</nz-breadcrumb>
```

#### breadcrumbTop: any

面包屑默认最高级，默认 `0`

#### navActive: any[]

被激活的导航数组

```html
<ul
  nz-menu
  [nzTheme]="'dark'"
  [nzInlineCollapsed]="collapsed"
  [nzMode]="collapsed?'vertical':'inline'"
>
  <ng-container
    *ngTemplateOutlet="navTpl; context: {$implicit: navLists}"
  ></ng-container>
  <ng-template #navTpl let-navs>
    <ng-container *ngFor="let x of navs">
      <ng-container *ngIf="x.routerlink;else notRouterlink">
        <li
          nz-menu-item
          [nzSelected]="bit.navActive.indexOf(x.id)!==-1"
          [bitOpen]="[x.routerlink]"
        >
          <i nz-icon [type]="x.icon"></i>
          <span class="nav-text">{{x.name}}</span>
        </li>
      </ng-container>
      <ng-template #notRouterlink>
        <li nz-submenu [nzOpen]="bit.navActive.indexOf(x.id)!==-1">
          <span title
            ><i nz-icon [type]="x.icon"></i><span>{{x.name}}</span></span
          >
          <ul>
            <ng-container
              *ngTemplateOutlet="navTpl; context: {$implicit: x.children}"
            ></ng-container>
          </ul>
        </li>
      </ng-template>
    </ng-container>
  </ng-template>
</ul>
```

#### search: { field: string, op: string, value: any }[]

搜索处理字段数组

#### listsLoading: boolean

列表正在加载状态, 使用在表格或列表组件中 `[nzLoading]="bit.listsLoading"`

#### pageLimit: number

分页，默认为配置服务 `pageLimit` 的值, 使用在表格或列表组件中，` [nzPageSize]="bit.pageLimit"`

#### listsTotals: number

列表数据总数, `listsTotals` 是由分页列表请求对象自动获取，`[nzTotal]="bit.listsTotals"`

#### listsPageIndex: number

分页索引页, `listsPageIndex` 是个双向绑定属性，可以通过外部去更改分页索引，` [(nzPageIndex)]="bit.lists_page_index"`

#### listsAllChecked: boolean

列表选项框状态为全选, `nzChecked` 是一个双向绑定属性，当全选选择框被动触发改变时，通过它的 `modelChange` 将同步其他数据的选择框状态：

```html
<th nzShowCheckbox [(nzChecked)]="bit.listsAllChecked"></th>
```

#### listsIndeterminate: boolean

列表选项框状态为不完整选择, `nzIndeterminate` 是不完整选择属性，当符合条件时，表头全选选择框将变为该状态：

```html
<th nzShowCheckbox [nzIndeterminate]="bit.listsIndeterminate"></th>
```

#### listsDisabledAction: boolean

列表操作板显示状态, 可在需要的标签中使用，已被选中的总数为 `0` 时，`listsDisabledAction=true`

```html
<button nz-button [disabled]="bit.listsDisabledAction" nzType="primary">
  执行选中的
</button>
```

#### listsCheckedNumber: number

列表选项框选择数量, 显示已被选中的总数：

```html
<p>{{bit.listsCheckedNumber}}</p>
```

#### open(path: any[])

路由跳转处理，`path[0]` 为基础地址，索引大于 0 则为参数，例如：`['app-edit',1]` 等价于 routerlink 的 `{app-edit}/1`，但包含跨级路由处理

#### crossLevel(selector: string)

路由跨级处理，通过使用 open 函数进行路由跳转会自动存储多级的路由参数，因此在跨越多级的跳转情况下可使用 `crossLevel` 可实现自动返回跨级，例如面包屑

```html
<nz-breadcrumb-item *ngFor="let x of bit.breadcrumb;last as islast">
  <ng-container *ngIf="islast;else notLast">{{x.name}}</ng-container>
  <ng-template #notLast>
    <a *ngIf="x.routerlink;else notRouterlink" [bitCrossLevel]="x.routerlink">
      {{x.name}}
    </a>
    <ng-template #notRouterlink>{{x.name}}</ng-template>
  </ng-template>
</nz-breadcrumb-item>
```

#### back()

返回上一级

#### setLocale(locale: 'zh_cn' | 'en_us')

设置语言包标识

#### equalI18n(i18n: string)

是否与多语言输入组件标识相等

```html
<nz-form-item formGroupName="name">
  <nz-form-label bitFormLabelCol nzRequired> {{bit.l['name']}} </nz-form-label>
  <ng-container *ngFor="let x of bit.i18nContain">
    <nz-form-control *ngIf="bit.equalI18n(x)" bitFormControlCol nzHasFeedback>
      <bit-i18n-tips #tips name="name"></bit-i18n-tips>
      <input
        nz-input
        [placeholder]="bit.l['namePlaceholder']"
        [nz-tooltip]="tips.ref"
        bitI18nTipsStyle
        [formControlName]="x"
        (ngModelChange)="bit.i18nUpdateValueAndValidity(form,'name',x)"
      />
      <nz-form-explain
        *bitExplain="{
        form:form,
        name:'name.'+x,
        explain:{
            required:bit.l['nameRequire']
        }
        };let msg"
        >{{msg}}</nz-form-explain
      >
    </nz-form-control>
  </ng-container>
</nz-form-item>
```

#### resetI18n()

多语言输入组件标识恢复默认值

#### registerLocales(packer: any, common = false)

注册语言包

- packer language 文件
- common 是否为公共语言包

```typescript
const packer = {
  name: ['名称', 'name']
};

ngOnInit() {
    this.bit.registerLocales(packer);
}
```

#### registerSearch(selector: string, ...search: { field: string, op: string, value: any }[]): Observable<any>

注册搜索字段

- selector 命名
- search `{field: string, value: any, op?: string }[]` 搜索参数
  - field 搜索字段名称
  - op 判断类型, 模糊搜索为 `like`,准确搜索为 `=`
  - value 搜索值
- Return `Observable<any>` 搜索注册完成

```typescript
ngOnInit() {
    this.bit.registerSearch('sys-index', {
        field: 'user', op: 'like', value: ''
    }).subscribe(() => {
        ...
    });
}
```

#### hasSearch(index: number): boolean

该索引下的搜索数组是否存在

```html
<ng-container *ngIf="bit.hasSearch(0)">
  <nz-select
    [(ngModel)]="bit.search[0].value"
    bitSearchChange="sys-index"
    (after)="getLists(true)"
  >
    <nz-option [nzValue]="x.id" [nzLabel]="x.name"></nz-option>
  </nz-select>
</ng-container>
```

#### listsRefreshStatus(lists: any[])

列表选择监听

- lists 数据源

在表格中的每个子选择框触发变化事件时，判断数据是否全选、不全选或完全不选择：

```html
<nz-table>
  <tbody>
    <tr *ngFor="let data of table.data">
      <td
        nzShowCheckbox
        [(nzChecked)]="data.checked"
        (nzCheckedChange)="bit.listsRefreshStatus(lists)"
      ></td>
    </tr>
  </tbody>
</nz-table>
```

#### listsCheckAll(event, lists: any[])

列表全选选择监听

- event 选择框状态改变触发事件
- lists 数据源

在表头命名层全选选择框选中后，同步每个数据的选择框状态

```html
<nz-table>
  <thead>
    <tr>
      <th
        nzShowCheckbox
        (nzCheckedChange)="bit.listsCheckAll($event,lists)"
      ></th>
    </tr>
  </thead>
</nz-table>
```

#### i18nGroup(options?: I18nGroupOptions)

多语言组件数值初始化

- options 多语言组件参数
  - value 默认值
  - validate 同步验证器数组
  - asyncValidate 异步验证器数组

表单初始化时设置多语言组件：

```typescript
this.bit.form = this.fb.group({
  name: this.fb.group(
    this.bit.i18nGroup({
      validate: {
        zh_cn: [Validators.required],
        en_us: [Validators.required],
      },
    })
  ),
});
```

#### i18nUpdateValueAndValidity(form: FormGroup, groupname: string, i18n: string)

多语言组件验证主动更新

- form FormGroup 对象
- groupname FormGroup 名称
- i18n 需更新的多语言组件标识

```html
<bit-i18n-tips #tips name="name"></bit-i18n-tips>
<input
  nz-input
  [placeholder]="bit.l['namePlaceholder']"
  [nz-tooltip]="tips.ref"
  bitI18nTipsStyle
  [formControlName]="x"
  (ngModelChange)="bit.i18nUpdateValueAndValidity(form,'name',x)"
/>
```

#### i18nUnionValidator(form: FormGroup, groupname: string)

多语言组件联合验证，配合 `i18nTips`

- form FormGroup 对象
- groupname FormGroup 名称

```typescript
this.form = this.fb.group({
  name: this.fb.group(
    this.bit.i18nGroup({
      validate: {
        zh_cn: [this.nameValidate],
        en_us: [this.nameValidate],
      },
    })
  ),
});

nameValidate = (control: AbstractControl) =>
  this.i18nUnionValidator(this.form, "name");
```

### CURD 请求

#### req(url: string, body: any = {}, , method = 'post'): Observable<any>

创建请求对象

- url 请求路由
- body 发送数据
- method 请求类型, 默认为 `post` 请求
- Return `Observable<any>`

!> 在之前需要定义配置 `origin` `namespace`

例如：请求导航接口

```typescript
this.http.req("main/nav").subscribe((res) => {
  console.log(res);
});
```

#### 如何跨域携带 Cookie

在 `environment` 中启用

```typescript
export const environment = {
  bit: {
    withCredentials: true,
  },
};
```

#### get(model: string, condition: any, special = false): Observable<any>

创建一个获取单条数据的处理

- model 模块名称
- condition 条件数组
- special 是否返回源数据

```typescript
get(id: number) {
  return this.http.get(this.model, {id});
}
```

#### lists(model: string, condition: any[] = [], refresh = false, special = false): Observable<any>

创建一个分页列表数据的处理

- model 模块名称
- condition 条件数组
- refresh 强制刷新，即重置分页相关的字段
- special 是否返回源数据

```typescript
lists(search: any, app: number, refresh: boolean): Observable<any> {
  return this.http.lists(this.model, search, refresh);
}
```

#### originLists(model: string, condition: any[] = [], special = false): Observable<any>

创建一个列表数据的处理

- model 模块名称
- condition 条件数组
- special 是否返回源数据

```typescript
originLists(): Observable<any> {
  return this.http.originLists(this.model);
}
```

#### add(model: string, data: any): Observable<any>

创建一个新增的处理

- model 模块名称
- data 新增数据

```typescript
add(data: any) {
  return this.http.add(this.model, data);
}
```

#### edit(model: string, data: any, condition: any = []): Observable<any>

创建一个编辑的处理

- model 模块名称
- data 编辑数据
- condition 条件数组

```typescript
edit(data: any): Observable<any> {
  return this.http.edit(this.model, data);
}
```

#### status(model: string, data: any, field = 'status', extra?: any): Observable<any>

创建一个状态切换的处理

- model 模块名称
- data 切换数据
- field 状态字段，默认 `status`
- extra 扩展字段

```typescript
status(data: any, app: number): Observable<any> {
  return this.http.status(this.model, data, undefined, {app});
}
```

#### delete(model: string, condition: any): Observable<any>

创建一个删除的处理

- model 模块名称
- condition 条件数组

```typescript
delete(id: any, app: number): Observable<any> {
  return this.http.delete(this.model, {id, app});
}
```

### 组件通讯

#### publish(topic: string, args?: any)

发布组件通讯事件

- topic 主题名称
- args 发送参数

```typescript
this.events.publish("any", {
  name: "kain",
});
```

#### on(topic: string): Observable<any>

订阅组件通讯事件

- topic 主题名称
- Return `Observable<any>`

```typescript
this.events.on("any").subscribe((args) => {
  console.log(args);
});
```

#### off(topic: string)

取消订阅的组件通讯事件

!> 在每次路由组件 `OnDestory` 时，都需要将自定义事件取消订阅

- topic 主题名称

```typescript
this.events.off("any");
```

语言包切换事件

```typescript
this.events.on("locale").subscribe((args) => {
  console.log(args);
  // zh_cn or en_us
});
```

## 扩展

### 本地存储

#### clear()

清除所有本地存储

```typescript
this.storage.clear();
```

#### setMenu(menu: any, router: any)

设置本地存储菜单数据

- menu 菜单数据
- router 路由数据

```typescript
this.storage.setMenu(data.menu, data.router);
```

#### autoBreadcrumb(router: Router, match = ['%7B', '%7D'])

自动计算面包屑

- router 应用 `Router` 对象
- match 路由标签获取符，默认`{}`

```typescript
this.storage.autoBreadcrumb(this.router);
```

#### destoryBreadcrumb()

销毁面包屑自动计算

```typescript
this.storage.destoryBreadcrumb();
```

### 提示框

#### static native

sweetalert2 对象

#### addAlert(res: any, form: FormGroup, reset?: any, customize?: AlertCustomize): Observable<any>

新增返回反馈栏

- res 请求响应结果
- form 表单对象
- reset FormGroup 重置值
- customize 自定义文本
  - text 提示文本
  - error_text 返回错误提示文本
  - confirmButtonText 确认按钮文本
  - cancelButtonText 取消按钮文本
- Return `Observable<any>`

例如, 在新增操作下组件表单提交中使用, `status` 为 `true` 表示确认提示框

```typescript

export class AdminAddComponent implements OnInit {

    ...

    submit(data) {
        this.adminService.add(data).pipe(
            switchMap(res => this.swal.addAlert(res, this.form, {
                status: true
            }))
        ).subscribe((status) => {
            // status => true or false
        });
    }
}
```

#### editAlert(res: any, customize?: AlertCustomize): Observable<any>

修改返回反馈栏

- res 请求响应结果
- customize 自定义文本
  - text 提示文本
  - error_text 返回错误提示文本
  - confirmButtonText 确认按钮文本
  - cancelButtonText 取消按钮文本
- Return `Observable<any>`

例如, 在修改操作下组件表单提交中使用, `status` 为 `true` 表示确认提示框

```typescript
export class AdminEditComponent implements OnInit {
    private id: any;

    ...

    submit(data) {
        data.id = this.id;
        this.adminService.edit(data).pipe(
            switchMap(res => this.swal.editAlert(res))
        ).subscribe((status) => {
            // status => true or false
        });
    }
}
```

#### deleteAlert(service: Observable<any>, customize?: AlertCustomize)

删除返回反馈栏

- service 删除请求对象
- customize 自定义文本
  - text 提示文本
  - confirmButtonText 确认按钮文本
  - cancelButtonText 取消按钮文本
- Return `Observable<any>`

例如, 在删除操作下使用, 订阅返回删除请求对象的响应值

```typescript
export class AdminIndexComponent implements OnInit {
    ...

  deleteData(id: any) {
    this.swal.deleteAlert(this.adminService.delete(id)).subscribe(res => {
      if (!res.error) {
        this.notification.success(this.bit.l['operate_success'], this.bit.l['delete_success']);
        this.getLists(true);
      } else {
        switch (res.msg) {
          case 'error:self':
            this.notification.error(this.bit.l['operate_error'], this.bit.l['error_delete_self']);
            break;
          default:
            this.notification.error(this.bit.l['operate_error'], this.bit.l['delete_error']);
        }
      }
    });
  }
}
```

## 组件

### 多语言切换器

```html
<bit-i18n-switch (i18nChange)="change($event)"></bit-i18n-switch>
```

- @Output() i18nChange: EventEmitter< string > 监听 `bit.i18n` 值的变化

控制表单内所有多语言输入组件，例如

```html
<ng-template #nzExtra>
  <bit-i18n-switch></bit-i18n-switch>
</ng-template>

<form nz-form [formGroup]="form" (bitFormSubmit)="submit($event)">
  <nz-form-item formGroupName="name">
    <nz-form-label bitFormLabelCol nzRequired>
      {{bit.l['name']}}
    </nz-form-label>
    <ng-container *ngFor="let x of bit.i18nContain">
      <nz-form-control *ngIf="bit.equalI18n(x)" bitFormControlCol nzHasFeedback>
        <bit-i18n-tips #tips name="name"></bit-i18n-tips>
        <input
          nz-input
          [placeholder]="bit.l['namePlaceholder']"
          [nz-tooltip]="tips.ref"
          bitI18nTipsStyle
          [formControlName]="x"
          (ngModelChange)="bit.i18nUpdateValueAndValidity(form,'name',x)"
        />
        <nz-form-explain
          *bitExplain="{
            form:form,
            name:'name.'+x,
            explain:{
                required:bit.l['nameRequire']
            }
            };let msg"
          >{{msg}}</nz-form-explain
        >
      </nz-form-control>
    </ng-container>
  </nz-form-item>
</form>
```

### 多语言提示

```html
<bit-i18n-tips #tips name="name"></bit-i18n-tips>
```

- tips TemplateRef< any >
- name FormControlName

联合属性指令 `bitI18nTipsStyle` 共同使用

```html
<bit-i18n-tips #tips name="name"></bit-i18n-tips>
<input
  nz-input
  [placeholder]="bit.l['namePlaceholder']"
  [nz-tooltip]="tips.ref"
  bitI18nTipsStyle
  [formControlName]="x"
  (ngModelChange)="bit.i18nUpdateValueAndValidity(form,'name',x)"
/>
```

## 指令

### 返回上一级

`[bitBack]`

- @Input() bitTrigger 触发方式 `click|touch`，默认 `click`

添加在按钮中

```html
<button nz-button type="button" bitBack>{{bit.l['cancel']}}</button>
```

### 跨级跳转

`[bitCrossLevel]`

- @Input() bitCrossLevel: string 跨级路由名称
- @Input() bitTrigger = 'click' 触发方式 `click|touch`，默认 `touch`

例如使用在面包屑

```html
<nz-breadcrumb [nzSeparator]="breadcrumbIcon">
  <ng-template #breadcrumbIcon>
    <i nz-icon type="right"></i>
  </ng-template>
  <nz-breadcrumb-item>
    <a routerLink="/">{{bit.l['dashboard']}}</a>
  </nz-breadcrumb-item>
  <nz-breadcrumb-item *ngFor="let x of bit.breadcrumb;last as islast">
    <ng-container *ngIf="islast;else notLast">{{x.name}}</ng-container>
    <ng-template #notLast>
      <a *ngIf="x.routerlink;else notRouterlink" [bitCrossLevel]="x.routerlink">
        {{x.name}}
      </a>
      <ng-template #notRouterlink>{{x.name}}</ng-template>
    </ng-template>
  </nz-breadcrumb-item>
</nz-breadcrumb>
```

### 表单验证提示

`[bitExplain]`

- @Input() set bitExplain(args: BitExplainArgs) 设置 `formControl` 的表单提醒信息

例如在表单中使用

```html
<nz-form-item>
  <nz-form-label bitFormLabelCol nzRequired>
    {{bit.l['username']}}
  </nz-form-label>
  <nz-form-control bitFormControlCol nzHasFeedback>
    <input
      nz-input
      formControlName="username"
      [placeholder]="bit.l['usernamePlaceholder']"
    />
    <nz-form-explain
      *bitExplain="{
        form:form,
        name:'username',
        async:true,
        explain:{
        required:bit.l['usernameRequire'],
        minlength:bit.l['usernameCorrectly'],
        maxlength:bit.l['usernameCorrectly'],
        duplicated:bit.l['usernameDuplicated'],
        pending:bit.l['validating']
        }
    };let msg"
      >{{msg}}</nz-form-explain
    >
  </nz-form-control>
</nz-form-item>
```

### 表单共用栅格

`[bitFormControlCol]`

在表单中使用

```html
<nz-form-control bitFormControlCol nzHasFeedback>
  <input
    nz-input
    formControlName="email"
    [placeholder]="bit.l['emailPlaceholder']"
  />
  <nz-form-explain
    *bitExplain="{
        form:form,
        name:'email',
        explain:{
        email:bit.l['emailCorrectly']
        }
    };let msg"
    >{{msg}}</nz-form-explain
  >
</nz-form-control>

<nz-form-control bitFormControlCol="submit">
  <button nz-button nzType="primary" [disabled]="!form.valid">
    {{bit.l['submit']}}
  </button>
  <button nz-button type="button" bitBack>{{bit.l['cancel']}}</button>
</nz-form-control>
```

`[bitFormLabelCol]`

在表单中使用

```html
<nz-form-label bitFormLabelCol> {{bit.l['email']}} </nz-form-label>
```

### 表单提交

`[bitFormSubmit]`

- @Output() bitFormSubmit: EventEmitter< any > 监听表单提交

在表单中使用

```html
<form nz-form [formGroup]="form" (bitFormSubmit)="submit($event)">....</form>
```

```typescript
form: FormGroup;

constructor(private fb: FormBuilder) {
}

this.form = this.fb.group({...});

submit(data) {...}
```

### 多语言提示样式

`[bitI18nTipsStyle]`

多语言提示样式统一，与组件 `<bit-i18n-tips #tips name="name"></bit-i18n-tips>` 配合使用

```html
<bit-i18n-tips #tips name="name"></bit-i18n-tips>
<input
  nz-input
  [placeholder]="bit.l['namePlaceholder']"
  [nz-tooltip]="tips.ref"
  bitI18nTipsStyle
  [formControlName]="x"
  (ngModelChange)="bit.i18nUpdateValueAndValidity(form,'name',x)"
/>
```

### 路由跳转

`[bitOpen]`

- @Input() bitOpen: any[] 路由跳转处理，`path[0]` 为基础地址，索引大于 0 则为参数，例如：`['app-edit',1]` 等价于 routerlink 的 `{app-edit}/1`，但包含跨级路由处理
- @Input() bitTrigger = 'click' 触发方式 `click|touch`，默认 `click`

例如替代 `routerlink`

```html
<button nz-button nzType="primary" nzSize="small" [bitOpen]="['sys-add']">
  <span>{{bit.l['add']}}</span>
</button>

<a [bitOpen]="['sys-add',data.id]">
  <i nz-icon type="edit"></i> {{bit.l['edit']}}
</a>
```

### 搜索监听

`[bitSearchChange]`

- @Input() bitSearchChange: string 搜索命名
- @Output() after: EventEmitter< any > 搜索变动之后

监听包含 `NgModelChange` 的组件中

```html
<ng-container *ngIf="bit.hasSearch(0)">
  <nz-select
    [(ngModel)]="bit.search[0].value"
    bitSearchChange="sys-index"
    (after)="getLists(true)"
  >
    <nz-option [nzValue]="x.id" [nzLabel]="x.name"></nz-option>
  </nz-select>
</ng-container>
```

### 搜索触发

`[bitSearchStart]`

- @Input() bitSearchStart: string 搜索命名
- @Output() after: EventEmitter< any > 开始搜索之后

注册搜索字段

```typescript
 this.bit.registerSearch('app-index', {
  field: 'name', op: 'like', value: ''
}).subscribe(() => {
  ...
});
```

同时给组件加入 `click` 与 `enter` 触发搜索

```html
<nz-input-group nzSearch [nzAddOnAfter]="nzAddOnAfter">
  <input
    type="text"
    [(ngModel)]="bit.search[0].value"
    bitSearchStart="app-index"
    (after)="getLists(true)"
    nz-input
    [placeholder]="bit.l['search']"
  />
</nz-input-group>

<ng-template #nzAddOnAfter>
  <button
    nz-button
    nzType="primary"
    nzSearch
    bitSearchStart="app-index"
    (after)="getLists(true)"
  >
    <i nz-icon type="search"></i>
  </button>
</ng-template>
```

### 搜索清除

`[bitSearchClear]`

- @Input() bitSearchClear: string 搜索命名
- @Input() reset: any 清除重置的数值
- @Output() after: EventEmitter< any > 清空搜索之后

注册搜索字段

```typescript
this.bit.registerSearch('api-index', {
  field: 'tag', op: '=', value: 0,
}, {
  field: 'name', op: 'like', value: ''
}).subscribe(() => {
 ...
});
```

清空搜索绑定在按钮 `click` 事件

```html
<button nz-button bitSearchClear="api-index" (after)="getLists(true)">
  {{bit.l['clearSearch']}}
</button>

<button
  nz-button
  bitSearchClear="api-index"
  [reset]="{tag:0}"
  (after)="getLists(true)"
>
  {{bit.l['clearSearch']}}
</button>
```

### 状态切换

`[bitStatusChange]`

- @Input() bitStatusChange: Observable<any> 状态切换请求
- @Input() bitControl = false 是否手动处理返回提示
- @Output() response: EventEmitter< any > 获取请求的响应值

例如控制管理员的状态

```html
<nz-switch
  [(ngModel)]="data.status"
  [bitStatusChange]="ramService.status(data)"
  [bitControl]="true"
  (response)="status($event)"
>
</nz-switch>
```

自定义返回提示

```typescript
status(res: any) {
    switch (res.msg) {
        case 'error:self':
            this.notification.error(this.bit.l.operateError, this.bit.l.errorStatusSelf);
            break;
        default:
            this.notification.error(this.bit.l.operateError, this.bit.l.statusError);
    }
}
```

### 上传

`[bitUpload]`

关联辅助配置，在上传组件中加入属性指令

```html
<nz-upload
  nzName="image"
  bitUpload
  nzListType="picture-card"
  (nzChange)="upload($event)"
>
  <ng-container *ngIf="!avatar">
    <i nz-icon type="plus"></i>
    <div class="ant-upload-text">{{bit.l['upload']}}</div>
  </ng-container>
  <img width="120" *ngIf="avatar" [src]="bit.static+avatar" class="avatar" />
</nz-upload>
```

## 管道

### 定义

- @Pipe({name: 'Defined'})
- value 数值
- Return `boolean`

例如，假设存在一个未定义属性

```typescript
export class AnyComponent {
    test;
}
```

在模版中判断使用

```html
<div *ngIf="test|Defined">
    <!-- here no display -->
</div>
```

### 未定义

- @Pipe({name: 'Undefined'})
- value 数值
- Return `boolean`

例如，假设存在一个未定义属性

```typescript
export class AnyComponent {
    test;
}
```

在模版中判断使用

```html
<div *ngIf="test|Undefined">
    <!-- here display -->
</div>
```

### 空数组

- @Pipe({name: 'EmptyArray'})
- value 数组
- Return `boolean`

例如，假设存在一个空数组属性

```typescript
export class AnyComponent {
    test = [];
}
```

在模版中判断使用

```html
<div *ngIf="!(test|EmptyArray)">
    <!-- here customize -->
</div>
```

### 空对象

- @Pipe({name: 'EmptyObject'})
- value 对象
- Return `boolean`

例如，假设存在一个空对象属性

```typescript
export class AnyComponent {
    test = {};
}
```

在模版中判断使用

```html
<div *ngIf="!(test|EmptyObject)">
    <!-- here customize -->
</div>
```

### 对象转数组

- @Pipe({name: 'ObjectToArray'})
- value 对象
- Return `any[]`

例如，假设一个对象

```typescript
export class AnyComponent {
    some = {
      car1: 'blue',
      car2: 'red'
    };
}
```

在模版中判断使用

```html
<div *ngFor="let x of some|ObjectToArray">
    <p>{{x.key}}</p>
    <p>{{x.rows}}</p>
</div>
```

### 对象转 Map 对象

- @Pipe({name: 'ObjectToMap'})
- value 对象
- Return `Map`

例如，假设一个对象

```typescript
export class AnyComponent {
    some = {
        car1: 'blue',
        car2: 'red'
    };
}
```

在模版中判断使用

```html
<ng-container *ngIf="some|ObjectToMap as x">
  <p>{{x.get('car1')}}</p>
</ng-container>
```

### 多语言填补显示

- @Pipe({name: 'JSONChose'})
- value 多语言类型的JSON字符串
- locale 语言包标识

例如，在接口直接返回多语言类型的JSON字符串

```typescript
const data = `{"zh_cn":"我","en_us":"me"}`;
```

如果指定某个语言为默认的显示

```html
<p>{{data|JSONChose:'en_us'}}</p>
<!-- display me -->
```

当然如果多语言类型的JSON字符串有缺失的语言存在

```typescript
const data = `{"zh_cn":"","en_us":"","ru-ru":"Я"}`;
```

这种情况则显示可以填补的语言

```html
<p>{{data|JSONChose}}</p>
<!-- display Я -->
```

### JSON 字符串转数组

- @Pipe({name: 'JSONParse'})
- value JSON字符串
- chkey 子键

例如，在接口直接返回JSON字符串数组

```typescript
const data = `{"name":"bit","version":1}`;
```

在这种情况下直接使用管道可以减少遍历处理

```html
<p>{{data|JSONParse:name}}</p>
<!-- display bit -->
```

### 字符串分割为数组

- @Pipe({name: 'Split'})
- text 字符串
- symbol 分割符号
- Return `string`

例如，在一些场景下存在字符串

```typescript
const str = 'a1|b2|c3';
```

那么可以通过该管道进行字符串分割

```html
<p>{{(str|Split:'|')[0]}}</p>
<!-- display a1 -->
```

### 数组拼接为字符串

- @Pipe({name: 'Join'})
- origin 字符串数组
- symbol 拼接符号
- Return `string`

例如，在一些场景下存在字符串数组

```typescript
const data = ['a1', 'b2', 'c3'];
```

那么可以通过该管道进行字符串拼接

```html
<p>{{data|Join:','}}</p>
<!-- display a1,b2,c3 -->
```

## 操作

### 组件异步验证器

- asyncValidator(req: Observable<any>, field = 'duplicated')
- req 请求对象
- field 自定义返回

在组件内定义异步验证器

``` typescript
import {operates} from 'ngx-bit';

export class AdminAddComponent implements OnInit {

  constructor(private swal: SwalService,
              private fb: FormBuilder,
              public bit: BitService,
              private notification: NzNotificationService,
              private adminService: AdminService) {
  }

  ngOnInit() {
    this.bit.form = this.fb.group({
      username: [null, [Validators.required,Validators.minLength(4),Validators.maxLength(20)],[this.validedUsername]],
    });
  }

  validedUsername = (control: AbstractControl) =>
    operates.asyncValidator(this.adminService.validedUsername(control.value));
}
```

### 判断空数组

- emptyArray(array: any[])
- array 数组
- Return `boolean`

判断一个数组是否为空

``` typescript
const test = [];

emptyArray(test); 
// true
```

### 判断空对象

- emptyObject(object: any)
- object 对象
- Return `boolean`

判断一个对象是否为空

``` typescript
const test = {};

emptyObject(test); 
// true
```

### 对象转数组

- objectToArray(object: any)
- object 对象
- Return `any[]`
  - key 原主键
  - rows 原键值

将一个对象转为数组

```typescript
const some = {
  car1: 'blue',
  car2: 'red'
};
objectToArray(some);
// [
//    {key: 'car1', rows: 'blue'},
//    {key: 'car2', rows: 'red'}
// ]
```

### 对象转 Map 对象

#### objectToMap(object: any)

- object 对象
- Return `Map<any,any>|false` 

将一个对象转为Map对象

```typescript
const some = {
  car1: 'blue',
  car2: 'red'
};
const t = objectToMap(some);
if(t) {
  console.log(t.get('car1'));
  // blue
}
```
